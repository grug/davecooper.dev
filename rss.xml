<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Dave Cooper's Blog RSS Feed]]></title><description><![CDATA[The (not so witty) ramblings of an Australian developer.]]></description><link>https://davecooper.dev</link><generator>GatsbyJS</generator><lastBuildDate>Fri, 05 Feb 2021 10:58:41 GMT</lastBuildDate><item><title><![CDATA[My new blog site]]></title><description><![CDATA[I’ve moved my blog post to a new platform! Ah yes, it’s time for that classic blog post: the one about how you’re using some new shiny thing…]]></description><link>https://davecooper.dev/my-new-blog-site/</link><guid isPermaLink="false">https://davecooper.dev/my-new-blog-site/</guid><pubDate>Mon, 08 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;I’ve moved my blog post to a new platform!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ah yes, it’s time for that classic blog post: the one about how you’re using some new shiny thing.&lt;/p&gt;
&lt;p&gt;My blog site has taken a few different forms over the years:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Wordpress&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This was when Wordpress was pretty garbage at doing most things. I know it has come a long way in the last 5 years.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Jekyll&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I switched to this when Jekyll had become popular. It integrated nicely with GitHub Pages at the time and there wasn’t really anything better in terms of dev experience. However, if you wanted to do any customisation, you had to write Ruby code. This led to some pretty attrocious code to be written by me well, more attrocious than usual…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gatsby&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Oh boy, this is nice.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I was a bit over being locked into a static site generator that used Ruby as its backbone as it felt really difficult to do anything due to my lack of comfort with the language. I knew a few people who had made the switch to Gatsby - and let’s face it, it’s the flavour of the month for now - so I thought I’d give it a go and see what the fuss is about.&lt;/p&gt;
&lt;p&gt;Recently, I’ve been doing some NextJS work for some side projects. I found the new-developer experience of using NextJS to be almost identical to Gatsby:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CLI tool to scaffold out your project&lt;/li&gt;
&lt;li&gt;Zero config to begin local development&lt;/li&gt;
&lt;li&gt;TypeScript support out-of-the-box&lt;/li&gt;
&lt;li&gt;Great tutorials/documentation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You get a &lt;em&gt;lot&lt;/em&gt; of nice things out-of-the-box:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TypeScript&lt;/li&gt;
&lt;li&gt;Route handling&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A starter template&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The Gatsby blog starter is what this site is based on and I find it a pretty nice starting point to customise from.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GraphQL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It’s all pretty slick and seems to work with minimal fuss.&lt;/p&gt;
&lt;p&gt;I decided to give myself an evening to move my blog over from Jekyll and to be honest, it was pretty simple. There was a bit of manual work that I could have automated, but I don’t have a huge amount of blog posts, so I figured copying and pasting content wasn’t that bad.&lt;/p&gt;
&lt;p&gt;I then spent another evening theming things, but ended up keeping things pretty similar to the starter template as it’s clean and super accessible.&lt;/p&gt;
&lt;p&gt;The only negative experience I had wasn’t actually Gatsby’s fault at all - it was GitHub Pages. I find the documentation to be super lacking as it is slightly ambiguous when it comes to hosting a static site on a custom domain with HTTPS. However, there was a silver lining here and that was I got to check out &lt;a href=&quot;https://vercel.com&quot;&gt;Vercel&lt;/a&gt; and all I can say is &lt;em&gt;wow&lt;/em&gt;. They’ve really got it together when it comes to getting up and running with a static site. It automatically worked out that my GitHub project was a Gatsby one and immediately deploys to a unique URL (plus your own custom domain if you provide one). It does this for every push to master which is great. It was also very clear how to set up with a custom domain so it gets a Dave Cooper thumbs up, for sure.&lt;/p&gt;
&lt;p&gt;Anyway, that’s my stream of consciousness about how much I’m a fan of Gatsby. Hit me up if you’ve got any questions about it or need help getting going with your own site.&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[My blog: now with Gatsby!]]></title><description><![CDATA[Last night I decided to rewrite my blog with Gatsby. This is my first Gatsby post! Soon I’ll document the process of bringing over my Jekyll…]]></description><link>https://davecooper.dev/new-blog/</link><guid isPermaLink="false">https://davecooper.dev/new-blog/</guid><pubDate>Fri, 29 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Last night I decided to rewrite my blog with Gatsby. This is my first Gatsby post!&lt;/p&gt;
&lt;p&gt;Soon I’ll document the process of bringing over my Jekyll site to the Gatsby world :)&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Mocking the window object in unit tests]]></title><description><![CDATA[Recently, I implemented some functionality that leveraged the browser’s performance API to help with measuring an initial page render time…]]></description><link>https://davecooper.dev/mocking-the-window-object-in-unit-tests/</link><guid isPermaLink="false">https://davecooper.dev/mocking-the-window-object-in-unit-tests/</guid><pubDate>Fri, 20 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Recently, I implemented some functionality that leveraged the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Performance&quot;&gt;browser’s performance API&lt;/a&gt; to help with measuring an initial page render time.&lt;/p&gt;
&lt;p&gt;The code looked something similar to this:&lt;/p&gt;
&lt;h3&gt;performance.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;measureInitialPageLoad&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEntries&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;el&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; el&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;MY_APP_INITIAL_PAGE_RENDERED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;MY_APP_INITIAL_PAGE_RENDERED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The code above does the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Defines a function called &lt;code class=&quot;language-text&quot;&gt;measureInitialPageLoad&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Calls &lt;code class=&quot;language-text&quot;&gt;window.performance.getEntries()&lt;/code&gt; to get an array of &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry&quot;&gt;PerformanceEntry objects&lt;/a&gt; made by the browser.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Filters the list of &lt;code class=&quot;language-text&quot;&gt;PerformanceEntry&lt;/code&gt;s to see if any of them are called &lt;code class=&quot;language-text&quot;&gt;MY_APP_INITIAL_PAGE_RENDERED&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We have prepended &lt;code class=&quot;language-text&quot;&gt;MY_APP&lt;/code&gt; to this &lt;code class=&quot;language-text&quot;&gt;PerformanceEntry&lt;/code&gt; to help ensure that nothing else is generating a &lt;code class=&quot;language-text&quot;&gt;PerformanceEntry&lt;/code&gt; called &lt;code class=&quot;language-text&quot;&gt;INITIAL_PAGE_RENDERED&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;If we haven’t measured this before (i.e. if the filter returns an array of length 0), then we call &lt;code class=&quot;language-text&quot;&gt;window.performance.measure()&lt;/code&gt; to create a named &lt;code class=&quot;language-text&quot;&gt;PerformanceEntry&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pretty straightforward and fairly uninteresting, right?&lt;/p&gt;
&lt;p&gt;Well, it starts to get interesting right around the time you need to write some unit tests for this piece of code. We’ve all been there - writing unit tests for code that leverages the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object but a lot of the time you don’t stop and think about what the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object &lt;em&gt;actually is&lt;/em&gt; and why it can sometimes feel a bit odd writing unit tests around it.&lt;/p&gt;
&lt;p&gt;To unit test this function, we need to reliably manipulate the &lt;code class=&quot;language-text&quot;&gt;window.performance&lt;/code&gt; object to do two things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Return a desired array of &lt;code class=&quot;language-text&quot;&gt;PerformanceEntry&lt;/code&gt; objects when &lt;code class=&quot;language-text&quot;&gt;window.performance.getEntries()&lt;/code&gt; is called.&lt;/li&gt;
&lt;li&gt;Track whether of not &lt;code class=&quot;language-text&quot;&gt;window.performance.measure&lt;/code&gt; has been called.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;One approach might be to try do something like:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: tests are written using Jest&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;performance.spec.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; measureInitialPageLoad &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Calls measure when we have not already measured the initial page rendering&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      getEntries&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockReturnValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      measure&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;measureInitialPageLoad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;INITIAL_PAGE_RENDERED_TEST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;measure&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is something I commonly see to try hack around the window object in unit tests and for &lt;em&gt;some things&lt;/em&gt; it does work. However, it turns out the &lt;code class=&quot;language-text&quot;&gt;window.perfomance&lt;/code&gt; object is &lt;strong&gt;read only&lt;/strong&gt;. Uh oh - this won’t work!&lt;/p&gt;
&lt;p&gt;You’ll be left with an error that looks like:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cannot assign to ‘performance’ because it is a read-only property.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Not to mention, it’s harder to clean up your mocks inbetween tests if you set things directly on the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object like this.&lt;/p&gt;
&lt;p&gt;Admittedly, this was the first thing I tried and left me feeling a bit baffled. I searched around for some examples online of other people trying to mock read-only &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; objects and the closest thing I could come across was something like this:&lt;/p&gt;
&lt;h3&gt;performance.spec.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; measureInitialPageLoad &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Calls measure when we have not already measured the initial page rendering&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; performance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      measure&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      getEntries&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      configurable&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      enumerable&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; performance&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      writable&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;measureInitialPageLoad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;INITIAL_PAGE_RENDERED_TEST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;measure&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Basically, we delete &lt;code class=&quot;language-text&quot;&gt;performance&lt;/code&gt; off the window object… but to do that, we have to cast as &lt;code class=&quot;language-text&quot;&gt;any&lt;/code&gt; because in the Jest testing environment, we’re actually referring to the NodeJS &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; which doesn’t have &lt;code class=&quot;language-text&quot;&gt;performance&lt;/code&gt; defined on it. We then add a writeable &lt;code class=&quot;language-text&quot;&gt;performance&lt;/code&gt; object to &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; with our Jest mocks and away we go.&lt;/p&gt;
&lt;p&gt;This works… but it’s not so great:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;It deletes something from the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;That sounds/feels a bit weird, doesn’t it?&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;We have to define a new property on &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; with a writeable &lt;code class=&quot;language-text&quot;&gt;performance&lt;/code&gt; object.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How many times have you had to do something like this before? I’m guessing the answer to this is zero.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ideally, what we want is a &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; that behaves normally but allows us to mock objects on it in the &lt;em&gt;same way&lt;/em&gt;, no matter if the object was originally read-only or not. For example, the pattern used to mock something on the &lt;code class=&quot;language-text&quot;&gt;window.location&lt;/code&gt; object is exactly the same as the pattern used to mock something on the &lt;code class=&quot;language-text&quot;&gt;window.performance&lt;/code&gt; object.&lt;/p&gt;
&lt;p&gt;🎉 It turns out we can do that 🎉&lt;/p&gt;
&lt;p&gt;To do this, we need to:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Export a copy of the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object from a module.&lt;/li&gt;
&lt;li&gt;Use that copy in our code.&lt;/li&gt;
&lt;li&gt;Once the two things above have been done, we can then mock the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object properly in our tests.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Let’s do it!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;First, let’s export a copy of the &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object.&lt;/p&gt;
&lt;p&gt;Unfortunately, neither TypeScript nor Jest allow us to do:&lt;/p&gt;
&lt;h3&gt;window.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; window &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So we have to create a copy and export that instead:&lt;/p&gt;
&lt;h3&gt;window.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; windowCopy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; windowCopy &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; window &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Okay, first step done. Next, let’s change our references to &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; in our code to use the copy we are now exporting:&lt;/p&gt;
&lt;h3&gt;performance.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; window &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./window&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;measureInitialPageLoad&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEntries&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;el&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; el&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;MY_APP_INITIAL_PAGE_RENDERED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;MY_APP_INITIAL_PAGE_RENDERED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That was easy - adding the import was the only thing we needed to do!&lt;/p&gt;
&lt;p&gt;Lastly, let’s mock the window object in our test (I’ve also included the other test that I wrote for this particular function):&lt;/p&gt;
&lt;h3&gt;performance.spec.ts&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; measureInitialPageLoad &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; window &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./window&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./window&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  window&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    performance&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      measure&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      getEntries&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;performance&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Calls measure when we have not already measured the initial page rendering&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getEntries &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockReturnValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;measureInitialPageLoad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;INITIAL_PAGE_RENDERED_TEST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;measure&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Does not call measure when we already have measured the initial page render&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getEntries &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockReturnValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&apos;INITIAL_PAGE_RENDERED_TEST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;measureInitialPageLoad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;INITIAL_PAGE_RENDERED_TEST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;performance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;measure&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And there we have it - a pattern that can be used to mock anything on the window object, regardless if it is read-only or not. The only thing to remember here is that when you want to mock a return value, you still need to cast the function you’re mocking to &lt;code class=&quot;language-text&quot;&gt;jest.Mock&lt;/code&gt; as TypeScript isn’t quite smart enough to work out that we are actually dealing with a mock at compile-time.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Concluding thoughts&lt;/h2&gt;
&lt;p&gt;Personally, I really like this pattern of working with &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; in unit tests because it provides a consistent pattern to mock anything we need regardless of what it is we’re trying to mock. The &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; object is a funny one because sometimes it’s not always clear how to work with it in a testing environment.&lt;/p&gt;
&lt;p&gt;I’d love to hear everyone’s thoughts on this and to share how they deal with mocking &lt;code class=&quot;language-text&quot;&gt;window&lt;/code&gt; in their testing environments!&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Sanely testing React hooks]]></title><description><![CDATA[Hi there 👋 Let’s talk about how to test React hooks. Suppose we have a React application (with TypeScript) that uses Redux for state…]]></description><link>https://davecooper.dev/sanely-testing-react-hooks/</link><guid isPermaLink="false">https://davecooper.dev/sanely-testing-react-hooks/</guid><pubDate>Wed, 15 Jan 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi there 👋 Let’s talk about how to test React hooks.&lt;/p&gt;
&lt;p&gt;Suppose we have a React application (with TypeScript) that uses Redux for state management.&lt;/p&gt;
&lt;p&gt;Suppose inside said application you have a hook that does the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Dispatch an action which ends up make an API call to get a &lt;code class=&quot;language-text&quot;&gt;thing&lt;/code&gt; and put it into state.&lt;/li&gt;
&lt;li&gt;Returns that &lt;code class=&quot;language-text&quot;&gt;thing&lt;/code&gt; from state.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;It might even look like this:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;useThing.ts&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; useDispatch &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useEffect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; getThingStart &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./redux/actions&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;useThing&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useDispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getThingStart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;thing&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useThing &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can then use this hook inside a component:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MyComponent.tsx&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useThing &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./useThing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useThing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;thing&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Loading...&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;This is your thing: &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;thing&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We might even have many components that use this hook.&lt;/p&gt;
&lt;p&gt;We probably want to test that this hook behaviour works as expected.&lt;/p&gt;
&lt;p&gt;How do we do this? What would good tests for this look like?&lt;/p&gt;
&lt;p&gt;The most common way I see custom hooks being tested is by testing a component that uses the custom hook. I’m really not a fan of this as component can have so many things going on inside them that could effect the internal state of a component. This effects the confidence we can have in the test which isn’t really what we’re aiming for.&lt;/p&gt;
&lt;p&gt;Since we can’t call hooks outside of components (with some exceptions), I also see people wrapping their hooks with dummy components. I’m not sure if this is better or worse than the previously mentioned strategy, but it still doesn’t make me happy. There are also cases of when things don’t go according to plan within the component that probably aren’t being catered for in a simple dummy component.&lt;/p&gt;
&lt;p&gt;Why don’t we try treat testing hooks as closely as we can to unit testing a regular JavaScript function? After all, hooks are just functions…&lt;/p&gt;
&lt;p&gt;Fortunately, we can write tests for our hooks in this style thanks to &lt;a href=&quot;https://github.com/testing-library/react-hooks-testing-library&quot;&gt;react-hook-testing-library&lt;/a&gt;. It provides a &lt;code class=&quot;language-text&quot;&gt;renderHook&lt;/code&gt; function which lets us pass in our hook and execute it. Under the hood, &lt;code class=&quot;language-text&quot;&gt;renderHook&lt;/code&gt; is using the hook within a dummy component, but the difference here is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To the test-writer, it appears that we are just executing a function with a callback - not an uncommon thing to do.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The dummy component is very defensively programmed and can handle pretty much any error/exception case gracefully (it’s actually somewhat complicated to do)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I took a look through the source code for this function and I’m really glad it wasn’t me that had to write it…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s see what tests for this hook might look like (using Jest):&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;useThing.spec.ts&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; renderHook &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@testing-library/react-hooks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; getThingStart &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./redux/actions&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useThing &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./useThing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  useSelector&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  useDispatch&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mockUseSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; useSelector &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mockUseDispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; useDispatch &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mockDispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;useThing hook&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;calls dispatch and retrieves our thing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    mockUseDispatch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockImplementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; mockDispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    mockUseSelector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockImplementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;this is our thing&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// This is our mocked state.&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; result &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useThing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Call our hook.&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;this is our thing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Make sure hook returns our slice of state.&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mockDispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalledWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getThingsStart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Make sure the right action was dispatched.&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Lovely.&lt;/p&gt;
&lt;p&gt;To break down what the test is doing…&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  useSelector&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  useDispatch&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mockUseSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; useSelector &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mockUseDispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; useDispatch &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mockDispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These lines set up our mocked behaviour for &lt;code class=&quot;language-text&quot;&gt;useSelector&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;useDispatch&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;. We need to be able to mock implementations for &lt;code class=&quot;language-text&quot;&gt;useSelector&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;useDispatch&lt;/code&gt; and we need to spy on what &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt; was called with.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;mockUseDispatch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockImplementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; mockDispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
mockUseSelector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockImplementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;this is our thing&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These lines tell the &lt;code class=&quot;language-text&quot;&gt;useDispatch&lt;/code&gt; hook to return our mocked &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt; function and for the &lt;code class=&quot;language-text&quot;&gt;useSelector&lt;/code&gt; hook to call a callback containing a mocked state object.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; result &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;renderHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useThing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This line calls &lt;code class=&quot;language-text&quot;&gt;renderHook&lt;/code&gt; and tells it to run our &lt;code class=&quot;language-text&quot;&gt;useThing&lt;/code&gt; hook. &lt;code class=&quot;language-text&quot;&gt;renderHook&lt;/code&gt; returns a &lt;code class=&quot;language-text&quot;&gt;result&lt;/code&gt; object.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;this is our thing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mockDispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalledWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getThingsStart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, we make our assertions! We first assert that the &lt;code class=&quot;language-text&quot;&gt;useThing&lt;/code&gt; hook returned the right value. Next we make sure that &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt; was called with the right action to dispatch.&lt;/p&gt;
&lt;h2&gt;Final thoughts&lt;/h2&gt;
&lt;p&gt;We now have a hook that we’ve concisely and confidently tested 🎉&lt;/p&gt;
&lt;p&gt;I’m really happy with this pattern of testing hooks and I think that people should consider treating their hook tests more like their unit tests.&lt;/p&gt;
&lt;p&gt;I’d love to hear any thoughts about this, so please feel free to reach out to me about it :)&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[My AngularConnect 2019 talk]]></title><description><![CDATA[I completely forgot to mention it, but you here is a link to my AngularConnect talk from last year. It was a lot of fun and I’m hoping to…]]></description><link>https://davecooper.dev/my-angular-connect-talk/</link><guid isPermaLink="false">https://davecooper.dev/my-angular-connect-talk/</guid><pubDate>Mon, 06 Jan 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I completely forgot to mention it, but you &lt;a href=&quot;https://www.youtube.com/watch?v=9C1QWwlHi0w&quot;&gt;here&lt;/a&gt; is a link to my AngularConnect talk from last year. It was a lot of fun and I’m hoping to speak there this year!&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A nice Express testing experience]]></title><description><![CDATA[Oh hello there - this is my first post of the new decade! 🎉 This one is a short story of relieving some testing pain. As an early…]]></description><link>https://davecooper.dev/a-nice-express-testing-experience/</link><guid isPermaLink="false">https://davecooper.dev/a-nice-express-testing-experience/</guid><pubDate>Sun, 05 Jan 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Oh hello there - this is my first post of the new decade! 🎉&lt;/p&gt;
&lt;p&gt;This one is a short story of relieving some testing pain. As an early declaration - I know I’m late to the party with the solution to the problem I came up with, but I still see lots and lots of code being written in the painful ways I describe so I think it’s worth talking about.&lt;/p&gt;
&lt;p&gt;I recently had to spin up a Node (TypeScript)/Express service from scratch.&lt;/p&gt;
&lt;p&gt;After scaffolding my project with the usual things, it was time to write an endpoint. I figured for monitoring purposes, I’ll want a ping/pong endpoint.&lt;/p&gt;
&lt;p&gt;Here’s what the application looks like so far in our journey:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;app.ts&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; express &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pingHandler &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./pingHandler&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/ping&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pingHandler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Dave&apos;s cool API server started&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;pingHandler.ts&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Request &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OK&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;http-status-codes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pingHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;_&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;PONG&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nothing fancy &lt;em&gt;at all&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Let’s try and test the &lt;code class=&quot;language-text&quot;&gt;/ping&lt;/code&gt; endpoint. It only does one thing and we have a single handler function that does anything interesting.&lt;/p&gt;
&lt;p&gt;It’s effectively one line of code that is pretty innocuous, if we’re being honest.&lt;/p&gt;
&lt;p&gt;This was the point that I realised that I see so much code to test Express endpoints that looks like the following:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;pingHandler.spec.ts&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Request &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pingHandler &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./pingHandler&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;pingHandler&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;responds with &apos;PONG&apos; and 200 when the endpoint it is hit&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; req &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; Request&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; res&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      end&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;pingHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;end&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is &lt;strong&gt;so painful&lt;/strong&gt;. There are so many things I find wrong with code like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There is a line that has two castings in it&lt;/li&gt;
&lt;li&gt;Two things are typed as &lt;code class=&quot;language-text&quot;&gt;any&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;It doesn’t actually check the response or status code&lt;/li&gt;
&lt;li&gt;It’s hard to read&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tests like this try to act like unit tests - but testing endpoints like this shouldn’t really be carried out like traditional unit tests. Obviously if this handler function were calling out to other functions we’ve written, then those would require unit testing. However, the sort of test we’re really looking for here sits halfway between what I’d describe as a unit test and an integration test.&lt;/p&gt;
&lt;p&gt;What can we do? Instead of trying to “unit test” a function like this, why not use a more appropriate tool for the job (&lt;em&gt;something something square peg, round hole…&lt;/em&gt;)?&lt;/p&gt;
&lt;p&gt;Hello &lt;a href=&quot;https://github.com/visionmedia/supertest&quot;&gt;supertest&lt;/a&gt; 👋&lt;/p&gt;
&lt;p&gt;Supertest allows us to pass our app to it, make requests and make assertions on the output in a clear and concise manner.&lt;/p&gt;
&lt;p&gt;I could go on about how the API works, but they have good docs for that - it’s probably easier to just show you what the test now looks like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; request &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;supertest&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; app &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;pingHandler&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;responds with &apos;PONG&apos; and 200 when the endpoint it is hit&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/ping&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;PONG&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Look at that! Much easier to read/understand what’s going on and we’re &lt;em&gt;actually testing the things that matter&lt;/em&gt;. I really think this is the way to go when compared to the previous style of test I showed you earlier.&lt;/p&gt;
&lt;p&gt;Anyways, that’s pretty much it for now. It looks very obvious when written out like this but I see it from developers all the time so I’m hoping this helps some people see that there are other ways of testing endpoints in their Express applications.&lt;/p&gt;
&lt;p&gt;Hit me up if you want to chat about it 😀&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Is moving to TypeScript in 2019 hard?]]></title><description><![CDATA[I recently had a conversation with some friends that went something like this: Friend A: I’m working on a JavaScript project. I’ll probably…]]></description><link>https://davecooper.dev/is-moving-to-typescript-hard/</link><guid isPermaLink="false">https://davecooper.dev/is-moving-to-typescript-hard/</guid><pubDate>Mon, 11 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently had a conversation with some friends that went something like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Friend A&lt;/strong&gt;: I’m working on a JavaScript project. I’ll probably migrate it to TypeScript at some point.
&lt;strong&gt;Me&lt;/strong&gt;: You should just do it now - it takes no time to do and you can immediately begin harnessing the features of TypeScript while not impacting your existing codebase.
&lt;strong&gt;Friend B&lt;/strong&gt;: Is it really easy? Last time I tried to do this I spent hours trying to understand a bunch of documentation and new tooling&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I’ve been using TypeScript for years now, so it’s quite hard to unlearn a lot of things I know about how to get it set up and strategies I’d take to migrate an existing JavaScript codebase to TypeScript, but I’ll try be methodical about this…&lt;/p&gt;
&lt;p&gt;Assumptions we’re making about the person wanting to make the switch:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;They have a pretty good knowledge of JavaScript.&lt;/li&gt;
&lt;li&gt;They have heard of TypeScript and possibly have a small idea of its capabilities (but mostly just the “TypeScript is a superset of JavaScript” and “it provides types!” parts).&lt;/li&gt;
&lt;li&gt;They’re able to use Google.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now, you could just take a look at the &lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/migrating-from-javascript.html&quot;&gt;migrating from JavaScript guide&lt;/a&gt; but this can be a bit overwhelming if you don’t know what’s in front of you.&lt;/p&gt;
&lt;p&gt;Let’s say we want to get on Dave’s TypeScript HypeWagon™ and have the following project:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
├── build
├── package.json
└── src
    ├── components
    │   └── foo.js
    └── util
        └── bar.js&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have a:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;build&lt;/code&gt; directory. This is where our built code lives.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; file. This is where our dependencies are managed and where our build scripts live.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;foo.js&lt;/code&gt; file inside a component directory.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;bar.js&lt;/code&gt; file inside a util directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cool - super contrived - let’s see where this leads us…&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;What do we need to do in order to start cooking with TypeScript?&lt;/p&gt;
&lt;h3&gt;Add TypeScript to your project&lt;/h3&gt;
&lt;p&gt;In order to use TypeScript, we obviously need to add it to our project first. If you’re using &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;NPM&lt;/a&gt;, run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; i --save-dev typescript&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you’re using &lt;a href=&quot;https://yarnpkg.com/lang/en/&quot;&gt;Yarn&lt;/a&gt;, run&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; --dev typescript&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Done. Next!&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Create a config file&lt;/h3&gt;
&lt;p&gt;Not a bad start. Let’s create a &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt; file in the root of our project and slap in the following config:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;compilerOptions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;outDir&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./build&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;allowJs&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;target&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;es6&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;include&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./src/**/*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This tells the TypeScript compiler a few things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Look inside the &lt;code class=&quot;language-text&quot;&gt;src/&lt;/code&gt; directory for TypeScript files (the &lt;code class=&quot;language-text&quot;&gt;include&lt;/code&gt; setting).&lt;/li&gt;
&lt;li&gt;Allow JavaScript files as well (the &lt;code class=&quot;language-text&quot;&gt;allowJs&lt;/code&gt; setting).&lt;/li&gt;
&lt;li&gt;Spit output files to the &lt;code class=&quot;language-text&quot;&gt;build/&lt;/code&gt; directory (the &lt;code class=&quot;language-text&quot;&gt;outDir&lt;/code&gt; setting).&lt;/li&gt;
&lt;li&gt;Emit ES6 code (the &lt;code class=&quot;language-text&quot;&gt;target&lt;/code&gt; setting).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For existing codebases, this is a quick way to dip your toes into the TypeScript waters. However, it is a very relaxed config that isn’t super TypeScript’y. We’ll talk about what this means in a bit.&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Build our code&lt;/h3&gt;
&lt;p&gt;Okay, we’ve installed TypeScript and defined a config that shouldn’t slow us down in getting up and running with TypeScript.&lt;/p&gt;
&lt;p&gt;Now we need to build our code using the TypeScript compiler. Let’s add a &lt;code class=&quot;language-text&quot;&gt;build&lt;/code&gt; script in &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;build&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tsc&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s all. The TypeScript compiler will know to look in the root of your project for &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt; (it will complain at you if it can’t find it) and begin doing your bidding. You’ll notice that your &lt;code class=&quot;language-text&quot;&gt;build/&lt;/code&gt; directory output mimics your &lt;code class=&quot;language-text&quot;&gt;src/&lt;/code&gt; directory structure. There will be more on this in a bit.&lt;/p&gt;
&lt;p&gt;🎉 At this stage, you’re all up and running - you can write and compile TypeScript 🎉&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Writing TypeScript&lt;/h3&gt;
&lt;p&gt;Now that we can compile TypeScript in our projects, let’s go ahead and rename our files to use the &lt;code class=&quot;language-text&quot;&gt;.ts&lt;/code&gt; (if the original file was using JS) or &lt;code class=&quot;language-text&quot;&gt;.tsx&lt;/code&gt; (if the original file was using JSX).&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Okay, what next&lt;/h3&gt;
&lt;p&gt;We’re not exactly done yet…&lt;/p&gt;
&lt;p&gt;The contrived example provided so far doesn’t account for (at least) a few things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;How do I hook this all up to appropriate tooling?&lt;/li&gt;
&lt;li&gt;How do I get more strict with my codebase?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Once both of these things are addressed, you’re basically 95% of the way there.&lt;/p&gt;
&lt;p&gt;So… let’s address them.&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Tooling&lt;/h3&gt;
&lt;p&gt;There are many bundling tools out there to help manage TypeScript projects, but for this article we’ll stick with the most popular one - &lt;a href=&quot;https://webpack.js.org/&quot;&gt;Webpack&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I could go on all day about the capabilities of Webpack, but for the scope of this article, let’s just focus on what we need to do for TypeScript.&lt;/p&gt;
&lt;p&gt;Let’s install a few things and I’ll explain them along the way:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; -D ts-loader webpack webpack-cli&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All we really need to tell Webpack is a few things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;What the input(s) to our source are.&lt;/li&gt;
&lt;li&gt;Where our output(s) are.&lt;/li&gt;
&lt;li&gt;What sort of files we want Webpack to handle (i.e. TypeScript files).&lt;/li&gt;
&lt;li&gt;What to do when we encounter a TypeScript file.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In order to do this, we’ll need to create a webpack config file (&lt;code class=&quot;language-text&quot;&gt;webpack.config.js&lt;/code&gt;) in the root of our project:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;path&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  entry&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./src/components/foo.ts&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  output&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    path&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__dirname&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;dist&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    filename&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bundle.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  resolve&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    extensions&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.jsx&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.ts&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.tsx&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  module&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    rules&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; test&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/\.tsx?$/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exclude&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/node_modules/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loader&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ts-loader&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we can observe the following things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The entry point into our application is &lt;code class=&quot;language-text&quot;&gt;./src/components/foo.ts&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We are outputting our bundle to &lt;code class=&quot;language-text&quot;&gt;./dist/bundle.js&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We want Webpack to handle &lt;code class=&quot;language-text&quot;&gt;.js&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;.jsx&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;.ts&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;.tsx&lt;/code&gt; files.&lt;/li&gt;
&lt;li&gt;We have a rule that when we encounter a &lt;code class=&quot;language-text&quot;&gt;.ts&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;.tsx&lt;/code&gt; file we run &lt;code class=&quot;language-text&quot;&gt;ts-loader&lt;/code&gt; on them.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;📀 *&lt;em&gt;Record scratch&lt;/em&gt;* 📀&lt;/p&gt;
&lt;p&gt;What on Earth is &lt;code class=&quot;language-text&quot;&gt;ts-loader&lt;/code&gt;?!&lt;/p&gt;
&lt;p&gt;A loader is a preprocessor that runs when a rule is matched. In this case, we run the &lt;code class=&quot;language-text&quot;&gt;ts-loader&lt;/code&gt; to convert our TypeScript to browser-friendly code.&lt;/p&gt;
&lt;p&gt;There are &lt;em&gt;loads&lt;/em&gt; of loaders that do &lt;em&gt;loads&lt;/em&gt; of things, and there are loaders that do the same things as other loaders (for instance, &lt;code class=&quot;language-text&quot;&gt;ts-loader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;babel-loader&lt;/code&gt; can do pretty similar things) so it can feel overwhelming at times.&lt;/p&gt;
&lt;p&gt;Okay. Now we have Webpack configured to do what we want it to, we need to run it. Fortunately it’s just a modification to our build script in &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;build&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tsc &amp;amp;&amp;amp; webpack&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This calls &lt;code class=&quot;language-text&quot;&gt;tsc&lt;/code&gt; to compile our code and spit out any errors that may have occurred, and then calls &lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt; to bundle our code into a single output file (this means we only need to serve one JavaScript file - there are advantages and disadvantages to this, but that is out of scope for this post).&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Scaling up&lt;/h3&gt;
&lt;p&gt;This post has covered how to start using TypeScript in an existing project but what do we do from here?&lt;/p&gt;
&lt;p&gt;It’s not considered good practice to keep the really loose rules that we have in our &lt;code class=&quot;language-text&quot;&gt;.tsconfig&lt;/code&gt; file as it won’t catch as many potential errors that we’d like to at compile-time.&lt;/p&gt;
&lt;p&gt;However, if you turn on all the stricter rules (you can read about all the compiler options &lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/compiler-options.html&quot;&gt;here&lt;/a&gt;) you’ll quickly find yourself working with a codebase with a lot of errors/warnings.&lt;/p&gt;
&lt;p&gt;If you have the time (and patience) you can go from 0-100, turn on &lt;code class=&quot;language-text&quot;&gt;strict&lt;/code&gt; mode and work through any errors/warnings. Otherwise you can try turning on one of the rules that &lt;code class=&quot;language-text&quot;&gt;strict&lt;/code&gt; mode applies at a time and working through it that way.&lt;/p&gt;
&lt;p&gt;One other way you can go about this is to be more lenient on older files in a codebase and enforce that all new files introduced into a codebase pass &lt;code class=&quot;language-text&quot;&gt;strict&lt;/code&gt; compiles.&lt;/p&gt;
&lt;h3&gt;Final thoughts&lt;/h3&gt;
&lt;p&gt;I guess the question here I was trying to answer is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Is it easy to migrate an existing JavaScript codebase to TypeScript&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I think the answer is: &lt;em&gt;it depends, but &lt;strong&gt;mostly yes&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;It’s really about striking a balance between time, effort and sanity.&lt;/p&gt;
&lt;p&gt;I still recommend that people make the plunge as you can start slow and forgiving and eventually ramp up to a fully-fledged TypeScript environment in your projects.&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Cool TypeScript 3.7 things]]></title><description><![CDATA[What a great day - it’s not raining in London and there’s a new version of TypeScript out - 🎉 - let’s talk about some of the neat stuff in…]]></description><link>https://davecooper.dev/typescript-3-7/</link><guid isPermaLink="false">https://davecooper.dev/typescript-3-7/</guid><pubDate>Wed, 06 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;What a great day - it’s not raining in London &lt;em&gt;and&lt;/em&gt; there’s a new version of TypeScript out - 🎉 - let’s talk about some of the neat stuff in it!&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: most of the knowledge in this post can be acquired by digesting the changelog for this release. I just thought I’d give my own summary as it may be easier to consume.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html&quot;&gt;TypeScript 3.7&lt;/a&gt; (I suggest you give this a quick flick through) has given us a super rad set of features/changes. I thought I’d pick a few of the things that I think are going to improve the quality of life for everyone and give a breakdown with code examples to illustrate their usefulness.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Spoiler: a class of annoying boilerplate is removed&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Optional Chaining&lt;/h3&gt;
&lt;p&gt;Let’s look at some code that we see frequently&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;foo &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baz&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;This sucks!&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We all have written code like this and we all hate it… fortunately, &lt;em&gt;optional chaining&lt;/em&gt; eliminates this (be careful, though - more on this in a second!). We can now do this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;foo&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;bar&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;baz&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Now we&apos;re cooking with gas!&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I can hear you breathing a sigh of relief from here… not having to write &lt;em&gt;&lt;strong&gt;that&lt;/strong&gt;&lt;/em&gt; sort of code again is a rather cathartic feeling.&lt;/p&gt;
&lt;p&gt;We can also use optional chaining for array access and calling functions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Array access:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; someArray&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Result: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;result&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Will be the value of the array element if someArray exists, else undefined.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Calling functions (code lifted from release notes):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; log&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;msg&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  log&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Request started at &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toISOString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  log&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Request finished at at &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toISOString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are some gotchas with this, though…&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Optional chaining doesn’t short circuit, so if you have a line of code such as:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;bar &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;someFunctionCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It doesn’t stop &lt;code class=&quot;language-text&quot;&gt;someFunctionCall&lt;/code&gt; from being invoked, meaning you may try divide &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; by whatever &lt;code class=&quot;language-text&quot;&gt;someFunctionCall&lt;/code&gt; returns which isn’t ideal. This is why it’s recommended you have &lt;code class=&quot;language-text&quot;&gt;strictNullChecks&lt;/code&gt; enabled.&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;The two following lines may look equivalent, but are not:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;foo &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first snippet will short circuit and not call &lt;code class=&quot;language-text&quot;&gt;foo()&lt;/code&gt; if it isn’t defined, whereas the second snippet will wrap the undefined case into a promise and return that.&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;When matching regular expressions, &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; is returned, not &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt;, which makes the two following lines non-equivalent:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; match &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; someString&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/someRegex/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; match &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; match&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; match &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; someString&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/someRegex/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; match&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To rewrite the first snippet using optional chaining, you’d also need to use the nullish coalescing operator (see the next section for a full explanation of this operator - for now you can think of it as a ‘fallback’ operator):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; match &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; someString&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/someRegex/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; match&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;??&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h3&gt;Nullish Coalescing&lt;/h3&gt;
&lt;p&gt;The nullish coalescing operator (or fallback operate, as I like to say in my head when reading code) is another sweet addition to TypeScript 3.7. In essence, it allows us to say “use this value if it is present, else do something else.&lt;/p&gt;
&lt;p&gt;Without the fallback operator, to achieve this sort of behaviour, we’d have to write something like (code shamelessly stolen again from the 3.7 release notes):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can now rewrite the above as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;??&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;🙏 Sweet merciful lord that is so much nicer 🙏&lt;/p&gt;
&lt;p&gt;This operator also now allows us to avoid subtle bugs, too. Before, a common thing I would see in code would be:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; x&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which works for &lt;em&gt;most&lt;/em&gt; cases but falls over at the fact that if &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt; is &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;&amp;#39;&amp;#39;&lt;/code&gt;, the fallback value will be used, despite &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;&amp;#39;&amp;#39;&lt;/code&gt; potentially being valid values. We can now safely rewrite it as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; x&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;??&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hooray!&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Uncalled Function Checks&lt;/h3&gt;
&lt;p&gt;The last neat thing I wanted to pick out of this release are uncalled function checks. Suppose you have the following code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;isAdmin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;doSomethingDangerous&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;user&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isAdmin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;doSomethingDangerous&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have a bug: &lt;code class=&quot;language-text&quot;&gt;user.isAdmin&lt;/code&gt; is always true because the function is defined, therefore we will always invoked &lt;code class=&quot;language-text&quot;&gt;doSomethingDangerous()&lt;/code&gt;!&lt;/p&gt;
&lt;p&gt;Uh oh 🙀&lt;/p&gt;
&lt;p&gt;Fortunately, this will now error in 3.7:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;// error&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; This condition will always &lt;span class=&quot;token builtin class-name&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; since the &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; is always defined.
//  Did you mean to call it instead?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;All of the features and improvements in TypeScript 3.7 are pretty neato burrito 🌯&lt;/p&gt;
&lt;p&gt;I’m super excited to use them all at length and you should be too!&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Speaking at AngularConnect 2019]]></title><description><![CDATA[🎉Speaker announcement🎉 I’m super proud to say I’ll be speaking at AngularConnect this year!  I hope to be spreading the good word of…]]></description><link>https://davecooper.dev/speaking-at-angular-connect/</link><guid isPermaLink="false">https://davecooper.dev/speaking-at-angular-connect/</guid><pubDate>Thu, 23 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;🎉Speaker announcement🎉&lt;/h3&gt;
&lt;p&gt;I’m super proud to say I’ll be speaking at &lt;a href=&quot;https://www.angularconnect.com/&quot;&gt;AngularConnect&lt;/a&gt; this year!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ec9fbe35d76c67785aeeac35b4bc9c1a/72e01/me.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABQABBP/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAATOwvEV4mR//xAAaEAACAgMAAAAAAAAAAAAAAAACEQEEEhQg/9oACAEBAAEFAkgCxjG1x//EABcRAQEBAQAAAAAAAAAAAAAAAAEAERL/2gAIAQMBAT8BTbgv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/AY1//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEgIUH/2gAIAQEABj8CToyP/8QAGxAAAgEFAAAAAAAAAAAAAAAAAREAECExwfD/2gAIAQEAAT8hGo4JKAicUZw7V//aAAwDAQACAAMAAAAQ3A//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QLEo7f//EABYRAQEBAAAAAAAAAAAAAAAAAAERAP/aAAgBAgEBPxBSjiSTf//EABwQAQEAAgIDAAAAAAAAAAAAAAERAEFRoRAhMf/aAAgBAQABPxBlbsgtZXfOBGI+Ag4jidO8dltL68//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Me&quot;
        title=&quot;Me&quot;
        src=&quot;/static/ec9fbe35d76c67785aeeac35b4bc9c1a/1c72d/me.jpg&quot;
        srcset=&quot;/static/ec9fbe35d76c67785aeeac35b4bc9c1a/a80bd/me.jpg 148w,
/static/ec9fbe35d76c67785aeeac35b4bc9c1a/1c91a/me.jpg 295w,
/static/ec9fbe35d76c67785aeeac35b4bc9c1a/1c72d/me.jpg 590w,
/static/ec9fbe35d76c67785aeeac35b4bc9c1a/a8a14/me.jpg 885w,
/static/ec9fbe35d76c67785aeeac35b4bc9c1a/72e01/me.jpg 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I hope to be spreading the good word of mocked data to the people of London.&lt;/p&gt;
&lt;p&gt;That is all.&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Injecting mock data into applications in 2019]]></title><description><![CDATA[Imagine this timeline… it’s 2019 and injecting mock data into web applications sucks. Keeping application state to be deterministic and…]]></description><link>https://davecooper.dev/injecting-mock-data-into-applications-in-2019/</link><guid isPermaLink="false">https://davecooper.dev/injecting-mock-data-into-applications-in-2019/</guid><pubDate>Tue, 30 Apr 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Imagine this timeline… it’s 2019 and injecting mock data into web applications sucks. Keeping application state to be deterministic and flexible is incredibly difficult and cumbersome.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Oh wait&lt;/em&gt;, this is the timeline we live in 😱&lt;/p&gt;
&lt;p&gt;Let’s take a look at that in the most shameless abrasive way possible - with me shilling a library I wrote!&lt;/p&gt;
&lt;h2&gt;How do we currently get data into our applications for development?&lt;/h2&gt;
&lt;p&gt;Some of the things that I’m sure we’ve all tried when trying to mash data into our applications:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Connect the application to production services&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;No. Just don’t.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If you do this, the developer police will come and take you to developer jail 🚓&lt;/p&gt;
&lt;p&gt;In developer jail, you have to talk about &lt;em&gt;“which IDE is the best”&lt;/em&gt; and &lt;em&gt;Tabs vs. Spaces&lt;/em&gt; all day, every day. You don’t want that and neither do I.&lt;/p&gt;
&lt;p&gt;This only leads to problems. You’ll accidentally mutate something on one (or all) of your users and everyone will be sad. Plus, you’ll be in jail.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Connect the application to a UAT/Staging services&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;No.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If you do this, the developer police will also come and take you to developer jail 🚓&lt;/p&gt;
&lt;p&gt;Inevitably, you’ll end up having many people connecting to these services and user data will be mutated in weird ways that make it difficult to test new features or reprocuce bugs. As with the above scenario, everyone will be sad (and in jail - which will probably make you more sad).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Connect the application to a local copy of your services&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is the first approach that won’t land you in developer jail.&lt;/p&gt;
&lt;p&gt;However, it’s a pain to do &lt;em&gt;well&lt;/em&gt; - and if you don’t do it well, you’ll go straight to &lt;em&gt;you-know-where&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;You don’t want to have to set your services up manually, so now you’ll probably need to containerise (how do you even spell that word?) things and have ways to reliably reproduce your data stores from scratch and then when things change with your application architecture and implementation etc… you’re probably going to have to do a lot of extra work to keep up with that.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Dave, all of these solutions suck so far. What else can I do?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Yes, yes they do. Let’s continue…&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Run a local mock service to expose data&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Okay, we’re getting somewhere.&lt;/p&gt;
&lt;p&gt;We could write a really simple service (Node/Express servers are easy to set up and is generally familiar to frontend developers) to expose the endpoints and data that our application has. Writing a simple Node service isn’t that hard and it doesn’t put us in a spot where we can be touching actual customer data, nor are we going to be at risk of modifying something that someone else is relying on, since it’s our own personal environment.&lt;/p&gt;
&lt;p&gt;The downside here, though, is that we now have quite a lot of code to write and maintain when all we really care about is the data that comes back in response to our requests. We also still don’t have easy ways of specifically and reliably testing happy/unhappy paths in our applications.&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;Dave, what about something off-the-shelf?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There are &lt;em&gt;loads and loads and loads and loads and loads and loads (and loads)&lt;/em&gt; of solutions available to achieve exactly what we’re talking about (did I mention there are loads of them?). Let’s just look at a couple to see what they’re like.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;disclaimer: I don’t want it to sound like I’m trash-talking anything that someone has put time and effort to develop. I’m merely pointing out the underlying problems with data injection that I see in web application development today.&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;json-server&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/typicode/json-server&quot;&gt;json-server&lt;/a&gt; is a simple solution that allows you to specify a JSON file describing the endpoints of your application, and provides a HTTP interface to that. Boom 💥. Zero coding and easy to set up. It also has about a billion Github ⭐️’s so obviously it’s doing a lot of things right.&lt;/p&gt;
&lt;p&gt;Here’s what a sample config looks like (shamelessly lifted from its Github page):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;posts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;json-server&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;typicode&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;comments&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;body&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;some comment&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;postId&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;profile&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;typicode&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Super easy to write. Super easy to understand. I’ll let you guess what is returned when you make a &lt;code class=&quot;language-text&quot;&gt;GET&lt;/code&gt; to &lt;code class=&quot;language-text&quot;&gt;/comments&lt;/code&gt; (&lt;em&gt;spoiler: you’re correct&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;There are some downsides to this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;What if I have a tonne of endpoints in my application?&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This file becomes quite large&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;How do I easily test happy/unhappy paths?&lt;/em&gt; (i.e. how do I test that my &lt;code class=&quot;language-text&quot;&gt;POST&lt;/code&gt; to &lt;code class=&quot;language-text&quot;&gt;/login&lt;/code&gt; has failed?)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;How can I simulate delay into individual responses?&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There is a &lt;code class=&quot;language-text&quot;&gt;--delay&lt;/code&gt; flag you can pass into the process, but the delay is applied to all responses&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Writing lots of JSON is a pain. You get little auto-complete and no typings on anything.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;apimocker&lt;/h2&gt;
&lt;p&gt;I wanted to give some code examples for &lt;a href=&quot;https://github.com/gstroup/apimocker&quot;&gt;apimocker&lt;/a&gt; but to come up with a self-contained example that demonstrates basic usage is a bit lengthy, so I’ll leave that up to you to check out on its Github page. Essentially, it’s a beefier version of &lt;code class=&quot;language-text&quot;&gt;json-server&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;apimocker&lt;/code&gt; allows for things like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Switch-responses based on URL parameters (this is a term I like to refer to as &lt;code class=&quot;language-text&quot;&gt;scenarios&lt;/code&gt; - remember this for later)&lt;/li&gt;
&lt;li&gt;Splitting of responses into files&lt;/li&gt;
&lt;li&gt;Global response delay, or endpoint-specific response delay&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is all very cool 😎, except that these config files become very large, very quickly and can be quite hard to read. For example, to configure more advanced switch-responses (&lt;code class=&quot;language-text&quot;&gt;scenarios&lt;/code&gt; - keep remembering this term!) you need to know &lt;code class=&quot;language-text&quot;&gt;JSON path&lt;/code&gt;, which is like &lt;code class=&quot;language-text&quot;&gt;XPath&lt;/code&gt;, only more annoying (okay, that’s subjective).&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;These solutions are still a bit heavy and a bit cumbersome, &lt;em&gt;in my opinion&lt;/em&gt;. In these cases, we’re spining up a new process and having that constantly run. My dev laptop is a fairly new Macbook, but it still sounds like it’s about to launch into orbit any time I look at it.&lt;/p&gt;
&lt;p&gt;Wouldn’t it just be nice to have some way of not writing these messy, sometimes complicated configs and save on machine resources?&lt;/p&gt;
&lt;p&gt;Hmmm 🤔&lt;/p&gt;
&lt;h2&gt;Enter data-mocks&lt;/h2&gt;
&lt;p&gt;Here’s the part where I shamelessly plug a library I’ve written. I bet you’ve been looking forward to this!&lt;/p&gt;
&lt;p&gt;I co-authored a library called &lt;a href=&quot;https://github.com/ovotech/data-mocks&quot;&gt;data-mocks&lt;/a&gt;. It’s very rad - but of course I’d say that…&lt;/p&gt;
&lt;p&gt;Here’s a brief overview of what it is/does:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Uses a code driven config to define endpoints we want to mock, and their respective responses&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Similar to &lt;a href=&quot;https://github.com/nabil-boag/angular-multimocks&quot;&gt;angular-multimocks&lt;/a&gt;, but &lt;em&gt;framework agnostic&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This means it’ll work with plain &lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Angular&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;React Native&lt;/code&gt; etc…&lt;/li&gt;
&lt;li&gt;This library was actually the inspiration for writing &lt;code class=&quot;language-text&quot;&gt;data-mocks&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Compatible with &lt;code class=&quot;language-text&quot;&gt;XHR&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Fetch&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Light and easy to set up&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Scenario&lt;/code&gt; (he said that term again!) support&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Under the hood, &lt;code class=&quot;language-text&quot;&gt;data-mocks&lt;/code&gt; intercepts HTTP requests your application makes, based on a regex performed against the URL that is being requested. No actual HTTP requests get made as they are picked up by &lt;a href=&quot;https://github.com/wheresrhys/fetch-mock&quot;&gt;fetch-mock&lt;/a&gt; for Fetch requests and &lt;a href=&quot;https://github.com/jameslnewell/xhr-mock&quot;&gt;xhr-mock&lt;/a&gt; for XHR requests. The authors of those two libraries are the real MVPs here and deserve massive amounts of respect 🏆&lt;/p&gt;
&lt;p&gt;Let’s look at a basic React app that makes a request to an API:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;App.jsx&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ReactDOM &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; SomeComponent &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./SomeComponent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SomeComponent&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;SomeComponent.jsx&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Component &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SomeComponent&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    thing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;componentDidMount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;www.davesapi.com/get-my-thing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;thing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Dave&apos;s cool thing&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        Here&apos;s a thing: {!this.state.thing ? &apos;Loading...&apos; : this.state.thing}
        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;thing &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;badThing&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;OH NO, THAT IS A BAD THING!&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When the component loads, we hit our server and we display our &lt;code class=&quot;language-text&quot;&gt;thing&lt;/code&gt; once it comes back.&lt;/p&gt;
&lt;p&gt;Neato burrito 🌯&lt;/p&gt;
&lt;p&gt;But what if something bad (i.e. &lt;code class=&quot;language-text&quot;&gt;badThing&lt;/code&gt;) comes back from the API? 🤔&lt;/p&gt;
&lt;p&gt;We could:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Hardcode our server to respond with &lt;code class=&quot;language-text&quot;&gt;badThing&lt;/code&gt;? ❌&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;That would suck and is way too manual&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Hardcode the response in our component? ❌&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;That would also suck and is also way too manual&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Use &lt;code class=&quot;language-text&quot;&gt;data-mocks&lt;/code&gt;? ✅&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Introducing data-mocks into an application is very simple.&lt;/p&gt;
&lt;p&gt;All a mock is, is the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A URL matcher, which is just a regex on the endpoint name&lt;/li&gt;
&lt;li&gt;A HTTP method&lt;/li&gt;
&lt;li&gt;A response object&lt;/li&gt;
&lt;li&gt;A response code&lt;/li&gt;
&lt;li&gt;A delay, in milliseconds&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That’s it. Five things to describe literally any mock. No JSON config. No having to learn a massive API or read a massive readme (although there is one available…).&lt;/p&gt;
&lt;p&gt;All we need to do is call the &lt;code class=&quot;language-text&quot;&gt;injectMocks&lt;/code&gt; function exposed by &lt;code class=&quot;language-text&quot;&gt;data-mocks&lt;/code&gt; and pass in a list of mocks we want to use. Very neat.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;App.jsx&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ReactDOM &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; SomeComponent &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./SomeComponent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; injectMocks &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;data-mocks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mocks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/get-my-thing/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      method&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;GET&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;this is a thing&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      responseCode&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      delay&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;injectMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mocks&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;default&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// This sets the default scenario&lt;/span&gt;

ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SomeComponent&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Sick - we’re good to go. We can now run our app locally and we get the same behaviour as we did when we were connecting to the actual service.&lt;/p&gt;
&lt;p&gt;But I promised you better than that - I promised you an easy way to test other paths of use in the app.&lt;/p&gt;
&lt;h2&gt;Scenarios&lt;/h2&gt;
&lt;p&gt;We can now talk about them! 🕺💃&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A scenario is just a mapping of responses that is given a name (i.e. the scenario you are running). The &lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt; scenario is the default set of behaviour exhibited by endpoints in the application. Any non-default scenario will give you the full set of default mocks, plus all mocks defined in the scenario. If a mock has the same URL matcher in the specified scenario, it will override the response in the corresponding default mock.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In simpler terms:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A scenario is a set of API responses you want your application to give in a given scenario (yes, we’ve used the term to define the term).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let’s see what this looks like:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;App.jsx&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ReactDOM &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; SomeComponent &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./SomeComponent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; injectMocks&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; extractScenarioFromLocation &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;data-mocks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mocks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/get-my-thing/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      method&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;GET&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;thisIsAThing&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      responseCode&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      delay&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  badThing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/get-my-thing/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      method&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;GET&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; thing&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;badThing&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      responseCode&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      delay&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;injectMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mocks&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;extractScenarioFromLocation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

ReactDOM&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SomeComponent&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You’re probably getting the idea here. However, two things will probably stick out:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;“When I run this, I still get the default scenario respone. What gives?”&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;“What is this &lt;code class=&quot;language-text&quot;&gt;extractScenarioFromLocation(window.location)&lt;/code&gt; business?”&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To answer both at once: we need to specify which scenario to run. The way we do this is through the &lt;em&gt;URL of the page we’re on&lt;/em&gt;. Go on, add &lt;code class=&quot;language-text&quot;&gt;?scenario=badThing&lt;/code&gt; to your query string (i.e. &lt;code class=&quot;language-text&quot;&gt;localhost:8080?scenario=badThing&lt;/code&gt;). If you have another way that you’d like to pass in the scenario name to the &lt;code class=&quot;language-text&quot;&gt;injectMocks&lt;/code&gt; function, feel free to not use the &lt;code class=&quot;language-text&quot;&gt;extractScenarioFromLocation&lt;/code&gt; util function.&lt;/p&gt;
&lt;p&gt;You’ll now see that we get the unhappy path response from our mocks.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This is especially helpful when running things like Cypress tests - as we don’t need to change anything at all in our code to test different behaviours and make assertions based on what comes back from our APIs!&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Other considerations&lt;/h2&gt;
&lt;p&gt;There are a couple of things to keep in mind with this approach that will make life nice and easy for you:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;You can avoid having mocks bundled into your application by surrounding the call to &lt;code class=&quot;language-text&quot;&gt;injectMocks&lt;/code&gt; with a &lt;code class=&quot;language-text&quot;&gt;if (process.env === &amp;#39;development&amp;#39;) { injectMocks(...); }&lt;/code&gt; block.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Alternatively you can define a separate entry point into your application (i.e. &lt;code class=&quot;language-text&quot;&gt;App.dev.jsx&lt;/code&gt;) and point your dev build to there. This is a bit more work, though.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;You can move your mock definitions into their own section of the project (i.e. &lt;code class=&quot;language-text&quot;&gt;/mocks&lt;/code&gt;) to avoid clutter in the entry point of your application&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Summary of what this allows us to do&lt;/h2&gt;
&lt;p&gt;With all of the above, we can now:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Easily integrate new mocks into the application&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Easily toggle between our new best friend, scenarios&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This allows us to test feature/bug fixes when developing &lt;strong&gt;and&lt;/strong&gt; in automated UI tests. This is the killer feature of &lt;code class=&quot;language-text&quot;&gt;data-mocks&lt;/code&gt;, in my opinion. Nothing else seems to offer something as easy (in terms of configuring and using the feature)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Write frontend code without having to have a single line of backend code (or a mock API server) written&lt;/li&gt;
&lt;li&gt;Not have to write &lt;em&gt;yet another&lt;/em&gt; JSON config&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;There you go, now we’re data-mock’ing!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If you’ve got any questions about this or want to contribute, please ping me or open a PR/Github issue 😊&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Unlikely Memory Leak]]></title><description><![CDATA[Here’s a pretty interesting bug that a mate recently ran into that piqued my interest. Picture this: you’re writing an MVP for an…]]></description><link>https://davecooper.dev/an-unlikely-memory-leak/</link><guid isPermaLink="false">https://davecooper.dev/an-unlikely-memory-leak/</guid><pubDate>Sun, 05 Feb 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Here’s a pretty interesting bug that a mate recently ran into that piqued my interest.&lt;/p&gt;
&lt;p&gt;Picture this: you’re writing an MVP for an application which has some data access components - it might look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;$http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;$http &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $http&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;$http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://myapi.com/some-endpoint&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This probably looks familiar to a lot of you Angular developers out there.&lt;/p&gt;
&lt;p&gt;Pretty innocuous, right?&lt;/p&gt;
&lt;p&gt;What if I were to say that there is a reasonably annoying potential memory leak here? Most people I’ve spoken to have either scoffed or tried &lt;em&gt;really&lt;/em&gt; hard to find something in the code that isn’t there.&lt;/p&gt;
&lt;p&gt;Let’s take a look at what happens as this code ran over time:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2ded693abfd7e9930b272370b66ef9e/21b4d/memory-usage.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAd0lEQVQY05WM7Q7CIAxFef9XlcLGtiotcNcGNZr9MN7k5PQjbYgxYiFCyguoJNyszzkZBKKElVarM5gZB98nB2PbrxQj4EfamGhzxtvdZsPBtMfnodvGqdoh+mGZbm3uX0ffGReHslc8qqJWgYjaE7UnxtOq/3ECpI06BzUK9LgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Memory usage&quot;
        title=&quot;Memory usage&quot;
        src=&quot;/static/c2ded693abfd7e9930b272370b66ef9e/fcda8/memory-usage.png&quot;
        srcset=&quot;/static/c2ded693abfd7e9930b272370b66ef9e/12f09/memory-usage.png 148w,
/static/c2ded693abfd7e9930b272370b66ef9e/e4a3f/memory-usage.png 295w,
/static/c2ded693abfd7e9930b272370b66ef9e/fcda8/memory-usage.png 590w,
/static/c2ded693abfd7e9930b272370b66ef9e/efc66/memory-usage.png 885w,
/static/c2ded693abfd7e9930b272370b66ef9e/c83ae/memory-usage.png 1180w,
/static/c2ded693abfd7e9930b272370b66ef9e/21b4d/memory-usage.png 1280w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Hmm… interesting. We seem to be building up a fair bit of memory usage and nothing seems to be garbage collected. Why?&lt;/p&gt;
&lt;p&gt;It’s probably not going to be the constructor for this class, so let’s write that off. I’ll also add in the assumption that Angular’s &lt;code class=&quot;language-text&quot;&gt;$http&lt;/code&gt; service isn’t causing any leaks for us here (although it might do - but that’s a separate discussion alogether). This leaves us with the &lt;code class=&quot;language-text&quot;&gt;doSomething()&lt;/code&gt; function. We’ve all retrieved data like this in Angular applications a billion times before without any problems, right?&lt;/p&gt;
&lt;p&gt;The solution to answering &lt;em&gt;why&lt;/em&gt; this memory usage was accumulating had to do with how frequently &lt;code class=&quot;language-text&quot;&gt;doSomething()&lt;/code&gt; was being hit and the size of the data that was being returned in the response to the API call.&lt;/p&gt;
&lt;p&gt;What was happening that certainly widened my eyes was that the &lt;code class=&quot;language-text&quot;&gt;console.log(response)&lt;/code&gt; was keeping a reference to &lt;code class=&quot;language-text&quot;&gt;response&lt;/code&gt; and thus not being garbage collected. I thought this was super strange because I couldn’t work out why.&lt;/p&gt;
&lt;p&gt;By now, some people have probably worked this out. The browser developer tools uses this reference which allows us to inspect objects while we’ve logged! One of the reasons why you shouldn’t keep client-side logging in your production code.&lt;/p&gt;
&lt;p&gt;This is how things look once the logging line is removed:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/30d1daf35e56df3bbbc5d9ed57b53d49/21b4d/after-collection.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAhUlEQVQY042MUQ7DIAxDuf9RCS3bCJUKCV6AdV3VnyE9OcZOnPeE1XuEsIAeAZ4IRB7rYrNlkaJlAZwSti2DOSMx45UY8cnD53zi8MfTBlS50v+K3LtOLami2Iui1Km7NX+9WN57ndbsUgftm3c9Zpe2Osw8KkNF9bOs48DUE9UrcqjtvgEryznPP5YOqQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;After collection&quot;
        title=&quot;After collection&quot;
        src=&quot;/static/30d1daf35e56df3bbbc5d9ed57b53d49/fcda8/after-collection.png&quot;
        srcset=&quot;/static/30d1daf35e56df3bbbc5d9ed57b53d49/12f09/after-collection.png 148w,
/static/30d1daf35e56df3bbbc5d9ed57b53d49/e4a3f/after-collection.png 295w,
/static/30d1daf35e56df3bbbc5d9ed57b53d49/fcda8/after-collection.png 590w,
/static/30d1daf35e56df3bbbc5d9ed57b53d49/efc66/after-collection.png 885w,
/static/30d1daf35e56df3bbbc5d9ed57b53d49/c83ae/after-collection.png 1180w,
/static/30d1daf35e56df3bbbc5d9ed57b53d49/21b4d/after-collection.png 1280w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;As you can see, the garbage collector is now able to kick in and remove references to our objects. I’ll also add here that this problem would arise regardless of the framework used here. It will happen even if you craft an XHR request manually and log the results.&lt;/p&gt;
&lt;p&gt;I’m not ashamed to admit that I didn’t work this one out myself, but I certainly loved learning about it and trying to assist in diagnosing it.&lt;/p&gt;
&lt;p&gt;Let me know what you think about this!&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Command line advertising: coming to a terminal near you!]]></title><description><![CDATA[This is a great one. Like most developers, I like to test things. At the moment, using Chimp alongside Cucumber for writing end-to-end tests…]]></description><link>https://davecooper.dev/command-line-advertising/</link><guid isPermaLink="false">https://davecooper.dev/command-line-advertising/</guid><pubDate>Thu, 17 Nov 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This is a great one.&lt;/p&gt;
&lt;p&gt;Like most developers, I like to test things. At the moment, using &lt;a href=&quot;https://chimp.readme.io/&quot;&gt;Chimp&lt;/a&gt; alongside &lt;a href=&quot;https://github.com/cucumber/cucumber-js&quot;&gt;Cucumber&lt;/a&gt; for writing end-to-end tests is pretty nice, in my opinion. We use it at my current workplace and it’s great. However, this looks like a recent interesting play from the Chimp crew.&lt;/p&gt;
&lt;p&gt;Now for the fun stuff.&lt;/p&gt;
&lt;p&gt;After installing Chimp on a new machine and going to execute it, I noticed something a little different to what I’m used to seeing when running command line utilities… see if you can spot it - you’ll need a keen eye.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8f2a0d653d6c76214d03575cdbfa69bb/b6e58/chimp.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 12.162162162162163%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAACABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAGOKyBn/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhAAAwAAAAAAAAAAAAAAAAAAAAEQ/9oACAEBAAE/IYz/2gAMAwEAAgADAAAAEPwP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QJ//EABYQAQEBAAAAAAAAAAAAAAAAAAAxEf/aAAgBAQABPxCsU//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Chimp Terminal&quot;
        title=&quot;Chimp Terminal&quot;
        src=&quot;/static/8f2a0d653d6c76214d03575cdbfa69bb/1c72d/chimp.jpg&quot;
        srcset=&quot;/static/8f2a0d653d6c76214d03575cdbfa69bb/a80bd/chimp.jpg 148w,
/static/8f2a0d653d6c76214d03575cdbfa69bb/1c91a/chimp.jpg 295w,
/static/8f2a0d653d6c76214d03575cdbfa69bb/1c72d/chimp.jpg 590w,
/static/8f2a0d653d6c76214d03575cdbfa69bb/a8a14/chimp.jpg 885w,
/static/8f2a0d653d6c76214d03575cdbfa69bb/fbd2c/chimp.jpg 1180w,
/static/8f2a0d653d6c76214d03575cdbfa69bb/b6e58/chimp.jpg 1430w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Yep, you guessed it - advertising has infected your precious, pristine, pure terminal! Although I’m not sure how pure that hamburger terminal of mine is…&lt;/p&gt;
&lt;p&gt;This took me by surprise. As far as I can recall, I don’t think I’ve seen links shoved in front of the user that lead to paid services.&lt;/p&gt;
&lt;p&gt;Let me also say here that:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I love Chimp.&lt;/li&gt;
&lt;li&gt;I think their developers do a great job.&lt;/li&gt;
&lt;li&gt;I’m not sure I think this is necessarily a bad thing.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;It does leave me quite confused, though. Could we start to see this happening more often? We all use command line tools all the time - why not start putting things into our eyeline?&lt;/p&gt;
&lt;p&gt;I tried Googling for examples of this but wasn’t able to find anything substantial. Maybe I am way behind the 8-ball on this one and it’s happened at scale before.&lt;/p&gt;
&lt;p&gt;What sort of things could this lead to? Answer: I’m not too sure.&lt;/p&gt;
&lt;p&gt;Let’s discuss this.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[My First Keyboard Build]]></title><description><![CDATA[I built a keyboard I made a keyboard – let me tell you about it! I’m even typing this post using the keyboard I built. How meta. This has…]]></description><link>https://davecooper.dev/i-built-a-keyboard/</link><guid isPermaLink="false">https://davecooper.dev/i-built-a-keyboard/</guid><pubDate>Tue, 14 Oct 2014 16:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;I built a keyboard&lt;/h2&gt;
&lt;p&gt;I made a keyboard – let me tell you about it! I’m even typing this post using the keyboard I built. How meta.&lt;/p&gt;
&lt;p&gt;This has been a fairly involved process so there is a lot to discuss. The main goal of this post is to talk people through the things I went through and what I wish I knew before I had started this project. This post will likely be edited a few times before I am happy with it so feel free to check back for added explanations/thoughts/photos.&lt;/p&gt;
&lt;h2&gt;Motivation&lt;/h2&gt;
&lt;p&gt;The most common questions/statements I got when telling people that I was building a keyboard from scratch were:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;“Why not just get a keyboard online or from a store locally?”&lt;/li&gt;
&lt;li&gt;“That’s going to cost too much money.”&lt;/li&gt;
&lt;li&gt;“You’ll never be able to make a keyboard as good as something commercially manufactured.”&lt;/li&gt;
&lt;li&gt;or just “why?”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There’s a really simple answer to what motivated me to do this. I wanted to see if I was capable of doing it. I’d never designed anything before, dealt with manufacturing companies, sourced materials like the ones I used, or wired something like this up before. From a glance it seemed to me like I would be able to do it with a solid amount of effort so I decided to go for it. To me, this was a hobby project, and hobby projects can run some people up into the thousands (think high end RC cars or models) so this was financially feasible for me to pursue.&lt;/p&gt;
&lt;p&gt;In regards to the build quality – yes, I am aware that this design has flaws (will be discussed later) and that the overall quality isn’t as good as, say, a Ducky, but I can definitely make something that is functional and isn’t completely terrible aesthetically (in my opinion).&lt;/p&gt;
&lt;p&gt;I’m a huge fan of DIY projects and as cliché as it sounds, I’m hoping that this post will help people realise that they can do this sort of stuff if they put their mind to it (not just limited to keyboards).&lt;/p&gt;
&lt;p&gt;Plus, who can have enough keyboards, right?!&lt;/p&gt;
&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;Just a quick bit of a background on myself:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;My name is Dave&lt;/li&gt;
&lt;li&gt;I live in Australia&lt;/li&gt;
&lt;li&gt;I like long walks on the beach&lt;/li&gt;
&lt;li&gt;I’m a programmer by trade&lt;/li&gt;
&lt;li&gt;I don’t have a creative bone in my body&lt;/li&gt;
&lt;li&gt;I’ve never done something like this before&lt;/li&gt;
&lt;li&gt;Everything that didn’t involve programming for this project was almost completely foreign to me before I started working on it&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Disclaimers&lt;/h2&gt;
&lt;p&gt;Probably a good idea to establish a few things first, just so we don’t get off on the wrong foot :)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I am not a designer, so I’m aware that things could be prettier&lt;/li&gt;
&lt;li&gt;The design was &lt;em&gt;largely&lt;/em&gt; inspired by other DIY 60% keyboards (i.e. matt3o’s BrownFox design).&lt;/li&gt;
&lt;li&gt;I was not aiming for perfection for this first keyboard build. It was to confirm that I was capable of being able to build a functional keyboard. My second build will largely be my own design (hopefully) and I will be aiming for as close to perfection (by my standards and preferences) as possible. This will obviously take a long time to do, but I’m absolutely willing to put the effort in given how much satisfaction I got from this first build.&lt;/li&gt;
&lt;li&gt;I am &lt;em&gt;terrible&lt;/em&gt; at soldering. Yes, I am aware that I have the fine motor skills of a 100 year old man. I blame this on being left handed and having the least steady hands on the planet.&lt;/li&gt;
&lt;li&gt;I am not a photographer. My photographs are all taken with my phone and my shaky hands (see previous point).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Okay, disclaimers out of the way – let’s talk about making a keyboard.&lt;/p&gt;
&lt;h2&gt;Materials&lt;/h2&gt;
&lt;p&gt;There’s a fairly long list of things I required for this build.&lt;/p&gt;
&lt;p&gt;Check out my workstation before I started building:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3d4fab6ede0f12d03203c17f83e4e155/ceaf9/desk.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB6KNJlQTiv//EABkQAAMBAQEAAAAAAAAAAAAAAAABAgMREv/aAAgBAQABBQLrLtzOdq4e2Z6hicn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAaEAABBQEAAAAAAAAAAAAAAAAAARESMqEx/9oACAEBAAY/AuDwUdC2FsLH/8QAHRABAAIABwAAAAAAAAAAAAAAAQARITFBUWFxkf/aAAgBAQABPyFDdHTpII8mWazdourTygTFs//aAAwDAQACAAMAAAAQzw//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QZH//xAAWEQEBAQAAAAAAAAAAAAAAAAAAESH/2gAIAQIBAT8QjX//xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMUFRcZH/2gAIAQEAAT8QIKXlMRZCjSZz7DVQ07BOGIuIrDs+TW2pTyd6j4yqijr5P//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;My desk&quot;
        title=&quot;My desk&quot;
        src=&quot;/static/3d4fab6ede0f12d03203c17f83e4e155/1c72d/desk.jpg&quot;
        srcset=&quot;/static/3d4fab6ede0f12d03203c17f83e4e155/a80bd/desk.jpg 148w,
/static/3d4fab6ede0f12d03203c17f83e4e155/1c91a/desk.jpg 295w,
/static/3d4fab6ede0f12d03203c17f83e4e155/1c72d/desk.jpg 590w,
/static/3d4fab6ede0f12d03203c17f83e4e155/a8a14/desk.jpg 885w,
/static/3d4fab6ede0f12d03203c17f83e4e155/ceaf9/desk.jpg 1111w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here is a list of everything and where I sourced them from:&lt;/p&gt;
&lt;h3&gt;Enclosure material&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Sheet steel (from &lt;a href=&quot;http://www.dicandilo.com.au/&quot;&gt;Dicandilo&lt;/a&gt;) – For the top and bottom layers, I went with 1.6mm sheets. One thing of note: steel is heavy. If you want your enclosure to be light, go with a lighter metal (i.e. aluminium).&lt;/li&gt;
&lt;li&gt;Acrylic (from &lt;a href=&quot;http://www.allacrylic.com.au/&quot;&gt;All Acrylic Shapes&lt;/a&gt;) – The middle two layers I went with 6mm thick clear acrylic sheets. This, to me, was aesthetically pleasing and also stopped my enclosure from being too heavy for my girly arms to pick up.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here’s a photo of the enclosure materials from the day I picked them up:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7d2f9e19aba81b9861bd1ef3573ab92e/9453e/enclosure-materials.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgT/2gAMAwEAAhADEAAAAYd51juSyG8G4ah0Rkf/xAAbEAACAgMBAAAAAAAAAAAAAAACAwABERITIf/aAAgBAQABBQJKKsbRCXWTvmpY+TocW8ptmf/EABgRAAIDAAAAAAAAAAAAAAAAAAAQERIh/9oACAEDAQE/Ackq/wD/xAAZEQEAAgMAAAAAAAAAAAAAAAABABEQEkH/2gAIAQIBAT8BLS5szmP/xAAaEAACAwEBAAAAAAAAAAAAAAAAARARMnEx/9oACAEBAAY/ArbNGLHXELsaYvI//8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFRYXGR/9oACAEBAAE/IRaLgVi+Tj17MySrghi7DiwYBQO25bCOvEtqif/aAAwDAQACAAMAAAAQc+9D/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERMf/aAAgBAwEBPxBpIhItFh//xAAXEQEBAQEAAAAAAAAAAAAAAAABABEx/9oACAECAQE/EEjU7T0T2//EAB8QAQACAQMFAAAAAAAAAAAAAAEAESExQVFhgZGh4f/aAAgBAQABPxAEfmJVzG6XgwmE1qpXTWUi4KDa/ly7yRe0xRiNDSwxPMp1EAqv0xoIFNrn/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Enclosure materials&quot;
        title=&quot;Enclosure materials&quot;
        src=&quot;/static/7d2f9e19aba81b9861bd1ef3573ab92e/1c72d/enclosure-materials.jpg&quot;
        srcset=&quot;/static/7d2f9e19aba81b9861bd1ef3573ab92e/a80bd/enclosure-materials.jpg 148w,
/static/7d2f9e19aba81b9861bd1ef3573ab92e/1c91a/enclosure-materials.jpg 295w,
/static/7d2f9e19aba81b9861bd1ef3573ab92e/1c72d/enclosure-materials.jpg 590w,
/static/7d2f9e19aba81b9861bd1ef3573ab92e/9453e/enclosure-materials.jpg 614w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Switches and keycaps&lt;/h3&gt;
&lt;p&gt;Such a contentious topic. Truth be told, I have no strong preference when it comes to Cherry switches. I’ve been using browns for a while now on my WASD v2 keyboard and saw no reason to change, so I went with Cherry MX Browns. I purchased from from &lt;a href=&quot;http://www.gonskeyboardworks.com/&quot;&gt;gonskeyboards&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I purchased my keycaps for this build from &lt;a href=&quot;http://www.wasdkeyboards.com/&quot;&gt;WASD Keyboards&lt;/a&gt;. Pretty basic set I know, but they get the job done.&lt;/p&gt;
&lt;h3&gt;Internals&lt;/h3&gt;
&lt;p&gt;The guts of the keyboard. Everything except the insulation rubber (which I got from eBay) I purchased from &lt;a href=&quot;http://littlebirdelectronics.com.au/&quot;&gt;Little Bird Electronics&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Diodes – 1N4148. This seems pretty standard for this sort of stuff.&lt;/li&gt;
&lt;li&gt;22 AWG hook-up wire. I strongly suggest you get a lot of different colours as it makes it much easier to track when you are soldering things up. I got black, brown, grey, red, white and yellow. I’d actually recommend using a slightly thinner gauge wire for this build. It will be easier to manipulate and much easier to wire up the columns.&lt;/li&gt;
&lt;li&gt;Teensy 2.0. This is a pretty sweet microcontroller – it has more than enough pins (just) to hook up all the rows and columns and is impressively tiny (as the name suggests). This makes it really easy to mount inside the enclosure and not get up in anything else’s business.&lt;/li&gt;
&lt;li&gt;Insulation rubber. I picked up some 0.8mm neoprene rubber off eBay and I definitely don’t regret it. Easy to work with, cheap, and looks pretty slick. The rubber was used on the inside of the back plate and underneath the Teensy board to stop shorting of pins. Probably a good idea since we’re dealing with electricity.&lt;/li&gt;
&lt;li&gt;A mini USB cable. I was silly and assumed I needed a micro USB cable, since everything else uses that. I was sadly mistaken.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Cost&lt;/h2&gt;
&lt;p&gt;Here is a rough breakdown of how much I paid for everything. Please keep in mind I bought a little extra of some things (diodes, wires etc…) so some prices may seem quite high:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Steel + cutting: $40&lt;/li&gt;
&lt;li&gt;Acrylic + cutting: $110 – Yep, acrylic over here is more expensive than the steel.&lt;/li&gt;
&lt;li&gt;Switches: $80&lt;/li&gt;
&lt;li&gt;Diodes: $20 (I bought extra)&lt;/li&gt;
&lt;li&gt;Wiring: $18 (I bought extra)&lt;/li&gt;
&lt;li&gt;Keycaps: $100. This could be greatly reduced if you got them as part of a group buy or you didn’t order a few individually printed ones like I did.&lt;/li&gt;
&lt;li&gt;Teensy: $20&lt;/li&gt;
&lt;li&gt;Insulation rubber: $20&lt;/li&gt;
&lt;li&gt;Mini USB cable: $5&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Other Things You Will Want&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;A decent soldering iron. You will thank yourself later. Also note: you will burn yourself many times throughout the build. Might as well do it with a fancy iron!&lt;/li&gt;
&lt;li&gt;LEADED SOLDER – I started the build without leaded solder and oh dear…&lt;/li&gt;
&lt;li&gt;Wire strippers. Do not use your teeth. Do not use someone else’s teeth. Do not use a scalpel. Use wire strippers.&lt;/li&gt;
&lt;li&gt;A decent working surface/area. A big table with a good cutting mat to work off is pretty good. I just picked up a cutting mat from my local electronics store, &lt;a href=&quot;http://www.jaycar.com.au/&quot;&gt;Jaycar&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Adhesive for the insulation rubber. Make sure that it won’t corrode the rubber or steel. I managed to get my hands on &lt;a href=&quot;http://www.jaycar.com.au/p/NA1522&quot;&gt;these guys&lt;/a&gt; and they are absolutely awesome.&lt;/li&gt;
&lt;li&gt;Solder braid. You will get solder in places you don’t want it. You will want to get rid of it. Solder braid is your best friend. All hail the braid.&lt;/li&gt;
&lt;li&gt;Tweezers. You are working with a small amount of wiggle room and you will wind up dropping something between the cracks or you will need something to feed a cable through a small gap. Tweezers are a huge mate in tough times like these.&lt;/li&gt;
&lt;li&gt;Patience.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Big emphasis on a decent working area. You will have a lot of stuff to keep track of and not having to stack things on top of each other makes a huge difference. Here is what my workstation looked like one Friday evening:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d2ecaaea20414f225e588880e1f2ac42/08d1d/friday-evening.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAByXE3iqIA/wD/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIDEjH/2gAIAQEAAQUChyEdDZpEbaktVn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAAhAxMkH/2gAIAQEABj8CnplimP/EABsQAQACAgMAAAAAAAAAAAAAAAEAESFRcZGx/9oACAEBAAE/IVAByFbhDUFc4cSi+E3t1P/aAAwDAQACAAMAAAAQ1/8A/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EBbb/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARQf/aAAgBAgEBPxBDll//xAAbEAEAAgMBAQAAAAAAAAAAAAABACERMVHB0f/aAAgBAQABPxDRdDFOoW2Jh5KOy47NA+x8DUw0vYiuZ7Sf/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Friday evening&quot;
        title=&quot;Friday evening&quot;
        src=&quot;/static/d2ecaaea20414f225e588880e1f2ac42/1c72d/friday-evening.jpg&quot;
        srcset=&quot;/static/d2ecaaea20414f225e588880e1f2ac42/a80bd/friday-evening.jpg 148w,
/static/d2ecaaea20414f225e588880e1f2ac42/1c91a/friday-evening.jpg 295w,
/static/d2ecaaea20414f225e588880e1f2ac42/1c72d/friday-evening.jpg 590w,
/static/d2ecaaea20414f225e588880e1f2ac42/a8a14/friday-evening.jpg 885w,
/static/d2ecaaea20414f225e588880e1f2ac42/08d1d/friday-evening.jpg 957w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;The design/build process&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;The enclosure&lt;/strong&gt;
I’m trying to work out what was the hardest thing to do for this build and I have a feeling the enclosure was it. I had absolutely no clue to begin with what I even wanted my keyboard to look like. I thought just trying to replicate my WASD v1 but wanted as little bezel as possible. I also liked the idea of a very simplistic design. I stumbled across matt3o’s BrownFox build and fell in love with that instantaneously and decided to base my design around it.&lt;/p&gt;
&lt;p&gt;From here it was a huge learning process. I had all the dimensions of the switches so I knew how big each hole in the design needed to be, and I even knew the dimensions of the keycaps I was going to be using so I knew how far apart the holes needed to be, what I &lt;em&gt;didn’t&lt;/em&gt; have a clue with was how to translate this into a drawing that a manufacturer knew how to build. I ended up going with the DraftSight software and, not to be too negative here since it got the job done, I was a bit disappointed. This probably has nothing to do with the software, more that I am not a draftsman. The software had a reasonably steep learning curve (in my opinion) with very little online support other than the instruction manual. This took a lot of tinkering around to get used to doing the things I needed to do which was mostly being able to draw lines to scale and provide their measurements. Sounds easy; it didn’t turn out to be for me (once again, it’s probably because I have had no experience here).&lt;/p&gt;
&lt;p&gt;I used the BrownFox drawing file as a base and changed things how I saw fit. This was mainly minor tweaks.&lt;/p&gt;
&lt;p&gt;I had to then find people to source the building materials from and cut them. Fortunately the two places I found for the steel and acrylic respectively sold &lt;em&gt;and&lt;/em&gt; cut them. This was pretty handy. As for what these people expect so they can help you out:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Provide a CAD drawing or PDF of your design, indicating scale (if it isn’t 1:1)&lt;/li&gt;
&lt;li&gt;Indicate the unique distances of cutouts. I sucked at this. It made my drawings very messy/sketchy, but it was necessary and I found most places didn’t want to work this out themselves even if you provided the dimensions/scale. This is what my top panel ended up looking like when I sent it off to the manufacturer:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2f92f329017f956cfd5a60cee9496a57/b6529/cad-drawing.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJElEQVQoz1WR6YqDQBCEff8n8g3yQxCMigcabzTGA4wm4rmfzobdFDi03VXVPT3Svu/jOL6+8T5xv9/ruqb6/gaEaZoQSvM8D8PQ930cx2matm1Llhp5QSWY/mFZFpJIDjE2URRlWeY4TpIkxJ7nNU1TVRUnXvUHIsNZFMXz+TzE27YFQWDbtq7rdKY/v7gQcGKafECsaVpxgpaHmBkoXK9XRVGiE8hEgJeYBYRhCMd13cvl4vs+izjEDADJsizDMEQf0ZMTNhrhRel2u6mqKssyF/xdGB9zYgmVrGmaKNGIKyBjyDzPxS4YmxhyWZZ/C0ODBTwYdGA9tILxeDzIC19AAAF38ixcYns0Ieq6jmcYTqzrKl6LDO48JEkuSMBtKbEpgh8zE+zuZ3gtBQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CAD drawing&quot;
        title=&quot;CAD drawing&quot;
        src=&quot;/static/2f92f329017f956cfd5a60cee9496a57/fcda8/cad-drawing.png&quot;
        srcset=&quot;/static/2f92f329017f956cfd5a60cee9496a57/12f09/cad-drawing.png 148w,
/static/2f92f329017f956cfd5a60cee9496a57/e4a3f/cad-drawing.png 295w,
/static/2f92f329017f956cfd5a60cee9496a57/fcda8/cad-drawing.png 590w,
/static/2f92f329017f956cfd5a60cee9496a57/efc66/cad-drawing.png 885w,
/static/2f92f329017f956cfd5a60cee9496a57/b6529/cad-drawing.png 1049w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;The internals&lt;/h3&gt;
&lt;p&gt;Cool, so we can fast-forward and I now have my enclosure materials. The most interesting thing here is now I have my switches. The switches can be mounted on the plates and we can begin soldering the diodes. Exciting stuff. This is was just after I finished putting the switches in. Let me tell you now how satisfied I was when the switches mounted perfectly on the steel plate. The cherry switches occupy a 14mm * 14mm hole. In fact, it’s probably best that you become acquainted with the &lt;a href=&quot;http://media.digikey.com/pdf/Data%20Sheets/Cherry%20PDFs/MX%20Series.pdf&quot;&gt;Cherry MX Datasheet&lt;/a&gt; if you plan on using Cherry switches.&lt;/p&gt;
&lt;p&gt;This was the first tangible milestone of the project. Exciting times!&lt;/p&gt;
&lt;p&gt;Now here’s another really common question I got: “Did you do this with a PCB or hand-wired?”. I opted for the hand-wired route for this build. At the time, I thought it would mean a quicker turnaround, which I later realised was not the case. However, I do have an appreciation for doing the hand-wired build, as it adds that ghetto factor you can’t get with a PCB.&lt;/p&gt;
&lt;h3&gt;Soldering&lt;/h3&gt;
&lt;p&gt;Okay, so the switches are in so the soldering should be a piece of cake, right?! Wrong. This took me a really, really, really, really long time to do. I think this mostly stemmed from my ultra shaky hands, which don’t lend themselves to fast or good soldering. Allow yourself plenty of time to do this if you plan on hand-wiring your board.&lt;/p&gt;
&lt;p&gt;First of all we need to connect a diode up to each individual switch and then connect up each row of diodes with each other (there are 5 rows total). &lt;a href=&quot;http://www.dribin.org/dave/keyboard/one_html/&quot;&gt;Here&lt;/a&gt; is an extremely useful article that explains the importance of the diodes and how they work. Basically it allows us to be able to identify which rows and columns are currently active during the event of keypresses.&lt;/p&gt;
&lt;p&gt;It’s also a pretty good idea to pre-solder a glob onto each of the pins on the switches, as this will save you a lot of time later. The diodes get soldered to the top left pin on each switch with the &lt;strong&gt;&lt;em&gt;black stripe on the diode facing the bottom (i.e. the row with the spacebar on it) of the keyboard&lt;/em&gt;&lt;/strong&gt;. There will be nothing worse discovering this problem once you think you’re done building the keyboard.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/929643ab6fac60066a698acab2830e4e/69e09/first-solder.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFzDJsZP//EABkQAAIDAQAAAAAAAAAAAAAAAAABERITIv/aAAgBAQABBQLZmhoxxHNWf//EABcRAQADAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8BqGP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAEBAQEAAAAAAAAAAAAAAAAAYRAx/9oACAEBAAY/Atquv//EABwQAQACAgMBAAAAAAAAAAAAAAEAESExQWGhcf/aAAgBAQABPyFo0RVuPY9z9YBhwhUWuHspihruf//aAAwDAQACAAMAAAAQAz//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxBw/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHxABAQABBAIDAAAAAAAAAAAAAREAITFBcVFhgaGx/9oACAEBAAE/EN+P5xyJvpETrs+8HKeCrzmtFA1VlD8zYSgtZGVRGA155//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;First solder&quot;
        title=&quot;First solder&quot;
        src=&quot;/static/929643ab6fac60066a698acab2830e4e/1c72d/first-solder.jpg&quot;
        srcset=&quot;/static/929643ab6fac60066a698acab2830e4e/a80bd/first-solder.jpg 148w,
/static/929643ab6fac60066a698acab2830e4e/1c91a/first-solder.jpg 295w,
/static/929643ab6fac60066a698acab2830e4e/1c72d/first-solder.jpg 590w,
/static/929643ab6fac60066a698acab2830e4e/a8a14/first-solder.jpg 885w,
/static/929643ab6fac60066a698acab2830e4e/69e09/first-solder.jpg 1107w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It’s also probably a good idea to pre-bend your diodes at a 90 degree angle before soldering, too. If you do this, your rows will be a) infinitely easier to solder and b) will look like they weren’t done by a 3-year-old who has had a litre of red cordial. Unfortunately, I did not pre-bend my diodes thinking I wouldn’t have a problem here. Guess what, the 3 year old did the soldering!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/abe46fe2591ec15b07572e9769d37e87/69e09/second-solder.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEAf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFJrpQU0j//xAAbEAABBQEBAAAAAAAAAAAAAAABAAIDERMEEP/aAAgBAQABBQKatbHh53kmMNQzX//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwGVh//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIhEDKR/9oACAEBAAY/Anllys3fD//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQVFh/9oACAEBAAE/IW9e5pBJuRV8rLbLwEsNs+T/AP/aAAwDAQACAAMAAAAQ1B//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBMP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EBj/xAAdEAACAgIDAQAAAAAAAAAAAAABEQAhMUFRYXGh/9oACAEBAAE/EDHorZrmaJoCJ0RDvlznHtCCAGxMlH2PKwo2D6p//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Second solder&quot;
        title=&quot;Second solder&quot;
        src=&quot;/static/abe46fe2591ec15b07572e9769d37e87/1c72d/second-solder.jpg&quot;
        srcset=&quot;/static/abe46fe2591ec15b07572e9769d37e87/a80bd/second-solder.jpg 148w,
/static/abe46fe2591ec15b07572e9769d37e87/1c91a/second-solder.jpg 295w,
/static/abe46fe2591ec15b07572e9769d37e87/1c72d/second-solder.jpg 590w,
/static/abe46fe2591ec15b07572e9769d37e87/a8a14/second-solder.jpg 885w,
/static/abe46fe2591ec15b07572e9769d37e87/69e09/second-solder.jpg 1107w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 466px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ba2732694c75cb0223fe24776de2c2cd/1b529/third-solder.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 177.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAQCAwUBBv/EABYBAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAAByJOzTnFgp1rH7iYua9LWEVQAf//EAB0QAAICAgMBAAAAAAAAAAAAAAABAhEDIhASITH/2gAIAQEAAQUCor0hBMlhpP7jJPVu2pTO2Q34bGf/xAAVEQEBAAAAAAAAAAAAAAAAAAAgIf/aAAgBAwEBPwGr/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwFf/8QAHBAAAQMFAAAAAAAAAAAAAAAAAAEgMREhcZGx/9oACAEBAAY/An5KoW4QuiFZ/8QAHhAAAgMAAQUAAAAAAAAAAAAAAAERITFBEFFhkeH/2gAIAQEAAT8h1VEw1edFsE67CxyGzyvZJOo5Vzo2AmbE4hlBtUUBr4iWOGcn/9oADAMBAAIAAwAAABCQCc3/AO//xAAZEQACAwEAAAAAAAAAAAAAAAAAAREg8EH/2gAIAQMBAT8QT6J2ZNP/xAAWEQADAAAAAAAAAAAAAAAAAAABESD/2gAIAQIBAT8QKr//xAAgEAEAAgICAQUAAAAAAAAAAAABABEhMUFRYYGRobHB/9oACAEBAAE/EBZYHdMCFt34jFJABQ1smGKjKHEVj7M0auxprAbfep18IchkvSq8xgANwdZmdJRFaHUD4AoCofEt/rj3SntnKM//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Third solder&quot;
        title=&quot;Third solder&quot;
        src=&quot;/static/ba2732694c75cb0223fe24776de2c2cd/1b529/third-solder.jpg&quot;
        srcset=&quot;/static/ba2732694c75cb0223fe24776de2c2cd/a80bd/third-solder.jpg 148w,
/static/ba2732694c75cb0223fe24776de2c2cd/1c91a/third-solder.jpg 295w,
/static/ba2732694c75cb0223fe24776de2c2cd/1b529/third-solder.jpg 466w&quot;
        sizes=&quot;(max-width: 466px) 100vw, 466px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/63872d3e063a4ce17002a23d2c2e77f5/cdec4/fourth-solder.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGe9j0imkX/xAAZEAADAQEBAAAAAAAAAAAAAAABAgMAERP/2gAIAQEAAQUCVetSRUE5EYZ5UceO/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAQUBAAAAAAAAAAAAAAAAAAEQITEyof/aAAgBAQAGPwIl66aQ/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERIUFRscH/2gAIAQEAAT8hn1JO+jRgaUiypAd/Jn//2gAMAwEAAgADAAAAELwv/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERIUH/2gAIAQMBAT8QhPSz/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxDZU//EABoQAQADAAMAAAAAAAAAAAAAAAEAETEhQVH/2gAIAQEAAT8QZ7mtXkB0g9mpyAgBWS0Cq+krggdiPaxfMJ//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Fourth solder&quot;
        title=&quot;Fourth solder&quot;
        src=&quot;/static/63872d3e063a4ce17002a23d2c2e77f5/1c72d/fourth-solder.jpg&quot;
        srcset=&quot;/static/63872d3e063a4ce17002a23d2c2e77f5/a80bd/fourth-solder.jpg 148w,
/static/63872d3e063a4ce17002a23d2c2e77f5/1c91a/fourth-solder.jpg 295w,
/static/63872d3e063a4ce17002a23d2c2e77f5/1c72d/fourth-solder.jpg 590w,
/static/63872d3e063a4ce17002a23d2c2e77f5/a8a14/fourth-solder.jpg 885w,
/static/63872d3e063a4ce17002a23d2c2e77f5/cdec4/fourth-solder.jpg 1108w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Sweet, so we’ve soldered on our diodes and connected up our rows. You’ve probably found this to be reasonably time consuming. Unfortunately, connecting up the columns is also just as time consuming and requires you to pay extra attention because if you don’t make the cables up right you will certainly get some shorts going.&lt;/p&gt;
&lt;p&gt;I’ll just quickly add here, if anyone doing a hand-wired build has a better/more efficient method of making the cables for the columns, please let me know because this part sucked for me and I couldn’t work out a better alternative.&lt;/p&gt;
&lt;p&gt;So we now need to hook up each individual column of switches. My build has 16 columns but you can have as many or little as you like depending on how you’ve designed your layout. The column wires connect to the right-hand pin on each switch (i.e. the pin that you didn’t connect a diode to).&lt;/p&gt;
&lt;p&gt;What I did to create my cables for the columns was get a length of wire and using my cable stripper I removed chunks of cable about the length between the pins in the column and then fed those chunks back on, leaving gaps to connect the wire to the pins. It looked something like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5f75517ecb1d23f0acb74d7c832d961a/6f6fc/cable-spacers.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 134.45945945945945%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAwT/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAFVLKx4KxsDzQ+qVJjcE//EABwQAAICAwEBAAAAAAAAAAAAAAACAxIBERMQIf/aAAgBAQABBQLhIUlUvOYYuWPuDZvzmjDQpv8A/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAETAv/aAAgBAwEBPwFbZQmTZ//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAgEBPwFGlf/EAB0QAAIBBAMAAAAAAAAAAAAAAAABMgIDIUEQIDH/2gAIAQEABj8CiRqRK4bN8ZTXTNKPD//EACEQAAIBAgYDAAAAAAAAAAAAAAABESFBEDFhcZGhgbHw/9oACAEBAAE/IfgxOStgQU7GQ24C08BTV0P24iNnjeY/gVp7s//aAAwDAQACAAMAAAAQnOeP/8QAGREAAwADAAAAAAAAAAAAAAAAAAFBEVFh/9oACAEDAQE/EKENtGMZ2P/EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8Qi0k//8QAHxABAAICAgIDAAAAAAAAAAAAAQARIVFBYTGRccHR/9oACAEBAAE/ENLfgS/OOb/U8EFcRNPH3hVfZ5zOV0Mu0n3EGMLFFUnuWuFxqXNhuo+4uFDR+0//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Cable spacers&quot;
        title=&quot;Cable spacers&quot;
        src=&quot;/static/5f75517ecb1d23f0acb74d7c832d961a/1c72d/cable-spacers.jpg&quot;
        srcset=&quot;/static/5f75517ecb1d23f0acb74d7c832d961a/a80bd/cable-spacers.jpg 148w,
/static/5f75517ecb1d23f0acb74d7c832d961a/1c91a/cable-spacers.jpg 295w,
/static/5f75517ecb1d23f0acb74d7c832d961a/1c72d/cable-spacers.jpg 590w,
/static/5f75517ecb1d23f0acb74d7c832d961a/6f6fc/cable-spacers.jpg 617w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;From here it was just a matter of connecting up each of the columns. Just keep in mind here, if you’re working with this gauge of wire, due to the small working space inside the keyboard it’s actually rather difficult to feed these lengths of cable through from the top of the column to the bottom. For these circumstances I just made the cables shorter and used multiple cables to connect up the column.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6f981189deb6c53e0ca4f969fd473794/a430b/columns.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 134.45945945945945%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAECAwQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAActq0Sc8iDVEbbzMH//EAB4QAAIBAwUAAAAAAAAAAAAAAAIRAAESIgMQEyEy/9oACAEBAAEFAhGcVIo8jOl+p6edyFx9uu3/xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAEDAQE/AQmX/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHBAAAQQDAQAAAAAAAAAAAAAAAQACETEQIEFx/9oACAEBAAY/AhPV24rDPU8CYfeAiIvX/8QAGhAAAwADAQAAAAAAAAAAAAAAAAERITFRYf/aAAgBAQABPyGPokQob3+A7eKbSyuBuyVlwi0rFpk6cJ4hNZGFjEhsmjPYbfT/2gAMAwEAAgADAAAAEMg9PP/EABgRAQADAQAAAAAAAAAAAAAAAAEAEBEx/9oACAEDAQE/EATWZhyv/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAMAAwADAAAAAAAAAAAAAQARITFBUWGx4f/aAAgBAQABPxBNDiBul+4d1pQpSx942CiKfJTKKOdtZQkKBbtyFSuuu/YTcKAOz3iI1NsjAbDJ4XbvH5GAmjiBzFLxEyhhFOqf/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Columns&quot;
        title=&quot;Columns&quot;
        src=&quot;/static/6f981189deb6c53e0ca4f969fd473794/1c72d/columns.jpg&quot;
        srcset=&quot;/static/6f981189deb6c53e0ca4f969fd473794/a80bd/columns.jpg 148w,
/static/6f981189deb6c53e0ca4f969fd473794/1c91a/columns.jpg 295w,
/static/6f981189deb6c53e0ca4f969fd473794/1c72d/columns.jpg 590w,
/static/6f981189deb6c53e0ca4f969fd473794/a430b/columns.jpg 621w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The column on the left uses just the one cable. The column on the right uses a couple of cables. As long as everything is joined up it’s all good.&lt;/p&gt;
&lt;p&gt;One you’ve hooked up all the cables then all we need to do is connect them to our microcontroller.&lt;/p&gt;
&lt;p&gt;Enter the Teensy.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./teensy.jpg&quot; alt=&quot;Teensy&quot;&gt;&lt;/p&gt;
&lt;p&gt;This little guy does a lot.&lt;/p&gt;
&lt;p&gt;All I’ve done in the picture above is solder a wire to each of the pins I will be using. Remember you have to avoid pin D6 and any of the power/ground pins. The pinout for the Teensy 2 can be found &lt;a href=&quot;https://www.pjrc.com/teensy/pinout.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now would also be a good time to attach the Teensy to the keyboard so we make sure that it will all connect up nicely. I put mine near the gaps where the spacebar switches are. This is probably an ideal spot in most hand-wired builds. Remember to put some insulation between the bottom of the teensy and the steel plate. This is where those adhesive strips I bought came in super handy.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/101b8344bbeab915cfcaa3b84c2223bd/ed9a5/teensy-adhesive.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHJrlYtAQH/xAAZEAEAAwEBAAAAAAAAAAAAAAABAAIDExT/2gAIAQEAAQUChCinWV1S3t1n/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgIDAAAAAAAAAAAAAAAAAEEBEQIygf/aAAgBAQAGPwKiMUx8NYLgR//EABwQAAMAAgMBAAAAAAAAAAAAAAABESFhMUFRof/aAAgBAQABPyFVZKeC3k7hAimaCaTCRx9ElJLFaP/aAAwDAQACAAMAAAAQtz//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QHLS//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxB1mn//xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMVFx/9oACAEBAAE/ECq+olHuJxoqUr1xQIAEQw8RwVWq9dfNwyKw77XcgCAA2z//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Teensy adhesive&quot;
        title=&quot;Teensy adhesive&quot;
        src=&quot;/static/101b8344bbeab915cfcaa3b84c2223bd/1c72d/teensy-adhesive.jpg&quot;
        srcset=&quot;/static/101b8344bbeab915cfcaa3b84c2223bd/a80bd/teensy-adhesive.jpg 148w,
/static/101b8344bbeab915cfcaa3b84c2223bd/1c91a/teensy-adhesive.jpg 295w,
/static/101b8344bbeab915cfcaa3b84c2223bd/1c72d/teensy-adhesive.jpg 590w,
/static/101b8344bbeab915cfcaa3b84c2223bd/a8a14/teensy-adhesive.jpg 885w,
/static/101b8344bbeab915cfcaa3b84c2223bd/ed9a5/teensy-adhesive.jpg 940w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The adhesive is making sure that the Teensy board isn’t going anywhere.&lt;/p&gt;
&lt;p&gt;Now it’s just a matter of connecting a wire from the teensy to each of the rows and columns. It doesn’t matter where on each row/column you connect the wires so do whatever works for you. I had a couple of really sad moments at this stage. I wanted to do a good job of routing the cables underneath the row/column wiring but the wire was just too thick to do a good job of this so I had to go against my preference and “spider” out over the top of my existing cabling.&lt;/p&gt;
&lt;p&gt;One other really important thing. Make sure you note which pin on the Teensy board is connected to which row/column. Write this information down somewhere. You’ll need it when it comes to programming the firmware.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cfbbfe320012bbd167e836799cf3c425/ed9a5/teensy-connected.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAXztKYJxRP/EABkQAAIDAQAAAAAAAAAAAAAAAAECAAQSIf/aAAgBAQABBQKy4zNmLWBQqIV7/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AWqQ/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHBAAAQQDAQAAAAAAAAAAAAAAAQACEBEhMpFR/9oACAEBAAY/Ag32Nj1A3mlQcOR//8QAHBAAAwACAwEAAAAAAAAAAAAAAAERIVExQWHR/9oACAEBAAE/IZ5HyxoquiP1D7ump9ijqe4Dx//aAAwDAQACAAMAAAAQ0A//xAAWEQEBAQAAAAAAAAAAAAAAAAARARD/2gAIAQMBAT8QQ3P/xAAWEQEBAQAAAAAAAAAAAAAAAAABACH/2gAIAQIBAT8QEMLL/8QAHhABAAMAAAcAAAAAAAAAAAAAAQARITFBUWFxseH/2gAIAQEAAT8QEjbs6KffUWsHZVk4YI6QGj3EF1c38+ZoyHej4n//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Teensy connected&quot;
        title=&quot;Teensy connected&quot;
        src=&quot;/static/cfbbfe320012bbd167e836799cf3c425/1c72d/teensy-connected.jpg&quot;
        srcset=&quot;/static/cfbbfe320012bbd167e836799cf3c425/a80bd/teensy-connected.jpg 148w,
/static/cfbbfe320012bbd167e836799cf3c425/1c91a/teensy-connected.jpg 295w,
/static/cfbbfe320012bbd167e836799cf3c425/1c72d/teensy-connected.jpg 590w,
/static/cfbbfe320012bbd167e836799cf3c425/a8a14/teensy-connected.jpg 885w,
/static/cfbbfe320012bbd167e836799cf3c425/ed9a5/teensy-connected.jpg 940w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you have a keen eye you’ll see that the yellow wire on the top right of the above image is connected to a diode instead of the pin on the right to it (because it is supposed to be connecting a column) – I did fix this after realising it after loading my firmware and noticing that column wasn’t working at all.&lt;/p&gt;
&lt;p&gt;At this stage, assuming we’ve done everything right our soldering is now done.&lt;/p&gt;
&lt;p&gt;Before we close up the enclosure, we need to put a rubber inlay on the inside of the bottom steel plate to avoid any accidental shorts. Once again, the adhesive strips come in handy here.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bf126ee9874b0346f8d5d6a864228d40/49e4f/rubber-inlay.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83.78378378378379%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUDBP/EABgBAAIDAAAAAAAAAAAAAAAAAAEDAAIE/9oADAMBAAIQAxAAAAHkpRKJVUc4oj6kZgKaP//EABsQAAIDAQEBAAAAAAAAAAAAAAACAQMSESEx/9oACAEBAAEFAotkqnRnhCdK6/FbKqN8g//EABkRAAMAAwAAAAAAAAAAAAAAAAABQQIQEf/aAAgBAwEBPwF8rHk4XX//xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8BI//EABoQAAICAwAAAAAAAAAAAAAAAAAyETEBIKH/2gAIAQEABj8CfI3SyxiJ0//EABwQAAICAgMAAAAAAAAAAAAAAAARASEQcTFB8f/aAAgBAQABPyGDV2yWFvsR0Mxl0PIEi5WZxP/aAAwDAQACAAMAAAAQwOAC/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAEDAQE/EEYApiYZf//EABYRAAMAAAAAAAAAAAAAAAAAAAERIP/aAAgBAgEBPxBGH//EAB0QAQADAAEFAAAAAAAAAAAAAAEAESExEEFRcfD/2gAIAQEAAT8QcEA5MzZ5SvllRyK7G42MF8SqxWSSRbXO84nR5/c//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Rubber inlay&quot;
        title=&quot;Rubber inlay&quot;
        src=&quot;/static/bf126ee9874b0346f8d5d6a864228d40/1c72d/rubber-inlay.jpg&quot;
        srcset=&quot;/static/bf126ee9874b0346f8d5d6a864228d40/a80bd/rubber-inlay.jpg 148w,
/static/bf126ee9874b0346f8d5d6a864228d40/1c91a/rubber-inlay.jpg 295w,
/static/bf126ee9874b0346f8d5d6a864228d40/1c72d/rubber-inlay.jpg 590w,
/static/bf126ee9874b0346f8d5d6a864228d40/49e4f/rubber-inlay.jpg 836w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;On to the programming part of this build.&lt;/p&gt;
&lt;h3&gt;Firmware&lt;/h3&gt;
&lt;p&gt;This section is going to be really short.&lt;/p&gt;
&lt;p&gt;I have an embedded software background so I understand what is required to drive the hardware we’re using so I thought I’d give writing the firmware from scratch a crack. I then found after not too long (i.e. getting a key to work) that it’s probably a better idea to see if someone had written some sort of framework to make our lives easier. Fortunately there is. You can find the Github repository for TMK’s keyboard project &lt;a href=&quot;https://github.com/tmk/tmk_keyboard/&quot;&gt;here&lt;/a&gt;. I &lt;em&gt;strongly&lt;/em&gt; suggest that you use this as a base and follow &lt;a href=&quot;http://deskthority.net/workshop-f7/how-to-build-your-very-own-keyboard-firmware-t7177.html&quot;&gt;matt3o’s firmware guide&lt;/a&gt; to get the firmware going on the Teensy if you don’t have any prior knowledge of how to write code to drive a keyboard.&lt;/p&gt;
&lt;p&gt;If you’re having trouble getting the firmware going on your Teensy board please let me know and I’ll do my best to assist you :) I know this section is brief, but there really isn’t anything I can tell you here that matt3o hasn’t already covered in great detail.&lt;/p&gt;
&lt;h2&gt;The finished product&lt;/h2&gt;
&lt;p&gt;Once you’ve hit this stage, you’re done! This is how my keyboard turned out. I left my WASD v2 in the shot just to let you see a bit of a comparison.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/28af7384bb12d27f7a62245ae3651726/0a7b4/finished-product.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAACAwD/2gAMAwEAAhADEAAAAcrcszWSS1u4msQaf//EABkQAAMBAQEAAAAAAAAAAAAAAAABAgMREv/aAAgBAQABBQKM4KWSG2ct1WdnKM9aPXUf/8QAFhEAAwAAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ASP/xAAYEQACAwAAAAAAAAAAAAAAAAAAEQEQYf/aAAgBAgEBPwFaMmv/xAAaEAACAgMAAAAAAAAAAAAAAAAAMQEQESFB/9oACAEBAAY/AtzOR2hHL//EAB4QAQEAAQMFAAAAAAAAAAAAAAEAESExUUGhscHh/9oACAEBAAE/IUnaG6xXjOIjrpDyeZH1A59rgTPUCd9r/9oADAMBAAIAAwAAABAY3/7/xAAWEQEBAQAAAAAAAAAAAAAAAAABADH/2gAIAQMBAT8QRHIgsX//xAAYEQEAAwEAAAAAAAAAAAAAAAABABARIf/aAAgBAgEBPxA11nEJX//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESFBMaGBsdH/2gAIAQEAAT8QDpNgoOoIYROb2JUyWLCrxACsXBoQK2FaduNIBCzxDr2P2MU0n//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Finished product&quot;
        title=&quot;Finished product&quot;
        src=&quot;/static/28af7384bb12d27f7a62245ae3651726/1c72d/finished-product.jpg&quot;
        srcset=&quot;/static/28af7384bb12d27f7a62245ae3651726/a80bd/finished-product.jpg 148w,
/static/28af7384bb12d27f7a62245ae3651726/1c91a/finished-product.jpg 295w,
/static/28af7384bb12d27f7a62245ae3651726/1c72d/finished-product.jpg 590w,
/static/28af7384bb12d27f7a62245ae3651726/0a7b4/finished-product.jpg 637w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;As for how the keyboard handles, it’s rock solid. It has a lot of weight to it so it doesn’t feel like it’s going anywhere and the keys feel fantastic. I’m 4,000 words into this blog post already and my fingers don’t feel fatigued at all and typing is a pleasure.&lt;/p&gt;
&lt;p&gt;Let’s discuss a few last things. Then I will let you go in peace :)&lt;/p&gt;
&lt;h2&gt;Flaws in my design&lt;/h2&gt;
&lt;h3&gt;The spacebar&lt;/h3&gt;
&lt;p&gt;This actually turned out to be a blessing in disguise. As mentioned earlier, I thought that having 3 switches for the spacebar would work out quite nicely. When I had 3 switches in the spacebar was &lt;em&gt;way&lt;/em&gt; too stiff. I then had the idea to change the 3 spacebar switches with cherry reds but wasn’t patient enough to get the switches in. In the end I decided to just take out the middle switch altogether. I was a bit nervous about this as I didn’t know if it was really going to make much of a difference. Boy was I relieved when I started using the keyboard. The spacebar is pretty stiff but I &lt;em&gt;much&lt;/em&gt; prefer it over any spacebar I’ve used on other keyboards. It feel much easier to activate the key which allows me to type easily.&lt;/p&gt;
&lt;h3&gt;Stabilisers&lt;/h3&gt;
&lt;p&gt;I slightly miscalculated the space for the stabilisers to slot in. This is easily rectified by our friend Mr. Dremel.&lt;/p&gt;
&lt;h3&gt;Right modifier keys&lt;/h3&gt;
&lt;p&gt;This was probably, in my opinion, the only &lt;em&gt;huge&lt;/em&gt; flaw in my design. I miscalculated the bottom row of key cut-outs which left me with a bit of a gap between my right modifier keys and the start of the arrow keys. I haven’t lost any sleep over it, but I will definitely be fixing that up for my second keyboard build.&lt;/p&gt;
&lt;p&gt;I’m sure there are a tonne more flaws with how I went about things and would love to hear your constructive criticism about them. Anything that I can address in future iterations I’d be keen to hear about.&lt;/p&gt;
&lt;h2&gt;What’s happening next?&lt;/h2&gt;
&lt;h3&gt;Current build&lt;/h3&gt;
&lt;p&gt;There are a couple of things that I want to tidy up with my current build before labelling it 100% complete:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Polish the steel a bit more so it has a more professional looking finish to it.&lt;/li&gt;
&lt;li&gt;Find a backslash key with the right profile (i.e. the same profile as the number keys).&lt;/li&gt;
&lt;li&gt;Order in some bolts to bolt up the enclosure. At the moment it’s still a bit wobbly because I’ve just got some pins holding the enclosure together.&lt;/li&gt;
&lt;li&gt;Order in a nice mini USB cable. The one I have at the moment is a bit ugly.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Next build&lt;/h3&gt;
&lt;p&gt;Here is a list of things that I will definitely be doing for my next build. I really will be aiming for perfection for my second build as I believe I have learnt enough valuable lessons from the first build to take a serious crack at making something that rivals a professional build.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Design and have a PCB manufactured.&lt;/li&gt;
&lt;li&gt;Use a decent set of keycaps (I have a set of DSA Dolch keycaps lying around so I may use them).&lt;/li&gt;
&lt;li&gt;Use treated steel for the top and bottom layers. The steel I used for this build looks a little bit scrappy. Having something with a smooth and consistent finish would be nice.&lt;/li&gt;
&lt;li&gt;Design a layout that is largely “my own”. I drew a lot of inspiration for this layout from other DIY jobs but I want to have a long hard think about what I really want out of my next keyboard and come up with a layout that truly fits it.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Acknowledgements&lt;/h2&gt;
&lt;p&gt;I can’t stress how appreciative I am for all of the help and assistance I received during the course of this project. I literally would not have been able to do this without the help of so many people. In no particular order, here are the people/communities that I am thankful for (apologies if I have missed anyone specific out – I will be updating this list as more people come to mind!):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;matt3o&lt;/strong&gt; – This guy is a beast. Anyone in the DIY keyboard community already knows this. I saw his BrownFox build and immediately had a million questions I contacted him about and he answered every last one in detail. Over time he helped me with a lot of things and his keyboard builds are largely what inspired mine.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gon&lt;/strong&gt; – This guy was another really helpful person involved with this. He runs an awesome DIY keyboard site here and has been making stuff that I could only dream of making for a long time.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Damon&lt;/strong&gt; (my house-mate) – Damon has to put up with more of my nonsense than anyone else on the planet. He has also acted as a huge sanity checker for my ideas and helped me source a lot of ideas for this project.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Peter&lt;/strong&gt; (he’s a bro) – Peter has always been a sounding board for things that I work on. He has taken a particular interest in this project and has been offering interesting opinions towards it. We are both going to be working on keyboard builds in parallel in the future (for my next project). Peter also has the quality of being brutally honest and not sugar-coating anything, which has always kept my ideas in check.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.reddit.com/r/mechanicalkeyboards&quot;&gt;r/mechanicalkeyboards&lt;/a&gt; – The reddit community have certainly been the source of a lot of inspiration for this as well as answering some of my less intelligent questions with patience and detail when I was just learning about how to do all this DIY stuff.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://deskthority.net/&quot;&gt;Deskthority&lt;/a&gt; – Same as above – very helpful community who were patient enough to deal with me during my (more) annoying phase.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Big ups to all of these guys and girls.&lt;/p&gt;
&lt;h2&gt;Final words&lt;/h2&gt;
&lt;p&gt;Thank you for reading this fairly lengthy post. I hope that you’ve taken something out of it. It genuinely means a lot to me that you have reached this far down (OK let’s be honest here, you just scrolled through to look for more pictures, didn’t you?!). If you guys and girls want me to elaborate on anything some more please let me know and I’ll update this blog post. I’m also perfectly happy to get more pictures of specific things if you want.&lt;/p&gt;
&lt;p&gt;If you have any other questions regarding the DIY keyboard stuff, my build, or just want to chat about whatever, you can hit me up on &lt;a href=&quot;https://twitter.com/davewritescodes&quot;&gt;Twitter&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;-Dave&lt;/p&gt;</content:encoded></item></channel></rss>